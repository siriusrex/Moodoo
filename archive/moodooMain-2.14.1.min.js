var baseURL="https://www.moodoo.net",logsOn=!0,theMoods="gloomy grouchy narky grumpy fuzzy happy boppy bouncy snappy zappy".split(" "),colourArray="#000000 #dd1f26 #df6b28 #f7971e #fed020 #f9ed32 #aad037 #3aa141 #007482 #1c75bc".split(" "),highlightArray="#333333 #e44c51 #e58953 #f9ac4b #fed94d #faf15b #bbd95f #61b467 #33909b #4491c9".split(" "),me={updates:null,firstName:"",lastName:"",email:"",ID:"",userID:"",moodNum:0,mood:"",status:"",lat:"",lng:"",currentAddress:"",publishToFacebook:"",
publishToMoodoo:"",publishToMap:"",reminder:"",code:""},token=null,updateMoodTimer,socialPublishFinished=!1,dataRefreshed=!1,canvasPoints,graphPoints,pointGroups,dotRadius,pieContext,tools={open:!1},environment={screenWidth:0,screenHeight:0,mobileSize:!1,touchInput:!1,backgroundRatio:.75},backgroundClear="cloud-background_moodoo2.png",backgroundBlur="cloud-background_moodoo_blurry.png",backgroundMobile="cloud-background_moodoo_mobile.jpg",inputs={hammertime:null};
function init(){logIt("init running");token=getParameterByName("token");logIt("token="+token);getEnvironment();logIt("environment.screenWidth="+environment.screenWidth);if(environment.touchInput){logIt("adding hammer pinch zoom function");var a=document.getElementById("mooderatorGraph");inputs.hammertime=new Hammer(a);inputs.hammertime.get("pinch").set({enable:!0});inputs.hammertime.on("pinchstart",function(a){onGestureStartGraph(a)});inputs.hammertime.on("pinchmove",function(a){logIt("got hammer scale on mooderator: scale="+
a.scale);logIt("got hammer event.center.pageX="+a.center.pageX);zoomChangeTouch(a.scale,a.center.pageX)});inputs.hammertime.on("pinchend",function(a){onGestureEndGraph(a)})}logIt("environment.touchInput="+environment.touchInput);if(navigator.userAgent.match(/Trident\/7\./))$("body").on("mousewheel",function(){event.preventDefault();window.scrollTo(0,window.pageYOffset-event.wheelDelta)});$(".section").each(function(){logIt("hiding "+$(this).attr("id"));$(this).css("visibility","hidden");$(this).css("display",
"none");$(this).css("opacity",0);$(this).data("myHeight",$(this).css("height"));$(this).css("height",0);$(this).data("hidden",!0)});$("#communication").css("height","auto");$("#communication").data("myHeight","auto");logIt("checking for cookie");token?(logIt("sending token to janrain_auth.php via ajax. token="+token),$.ajax({type:"POST",url:"janrain_auth.php",data:"token="+token,success:function(a,c,e){logIt("res="+a+", status="+c+", xhr="+e);for(var g in e)logIt("res["+g+"]="+a[g]);a.profile?(logIt("identifier: "+
a.profile.identifier),logIt("displayName: "+a.profile.displayName),logIt("primaryKey: "+a.profile.primaryKey),a.profile.name&&logIt("givenName: "+a.profile.name.givenName),logIt("sending social info to server"),logIt("trying to close janrain window"),janrain.engage&&janrain.engage.signin&&janrain.engage.signin.modal.close(),loadUser(null,a.profile)):(logIt("error - no profile returned, bad token"),window.location.href=baseURL)},error:function(a,c,e){logIt("error when sending token to janrain_auth");
window.location.href=baseURL}})):(logIt("cookie ID is invalid, reverting to janrain. janrainReady="+janrainReady),showDiv("auth"));$("#status").on("touchstart",function(a){logIt("status input touchstart event");$(this).focus()});$("#status").focus(function(){logIt("status input field focus event");$("#status").animate({width:100},100,function(){})});$("#status").keypress(function(){logIt("#status just received keypress");var a=$("#status").val(),c=12*a.length;environment.mobileSize&&(c=20*a.length);
100>c&&(c=100);c>.7*environment.screenWidth&&(c=.7*environment.screenWidth);$("#status").animate({width:c},100,function(){})});$("#mooderatorGraph").mouseover(function(a){logIt("mouseover on mooderator event");onMouseOverGraph(a)});$("#mooderatorGraph").mouseout(function(a){logIt("mouseoout mooderator event");onMouseOutGraph(a)});$("#mooderatorGraph").on("touchstart",onTouchStartGraph);$("#mooderatorGraph").on("touchmove",onTouchMoveGraph);$("#mooderatorGraph").on("touchend",onTouchEndGraph);$("#mooderatorGraph").on("touchcancel",
onTouchCancelGraph);$("#moodPieGraph").mouseover(function(a){logIt("mouseover on moodPie");onMouseOverPie(a)});$("#moodPieGraph").mouseout(function(a){logIt("mouseout on moodPie");onMouseOutPie(a)});$("#moodInput a").click(function(a){logIt("clicked mood button:"+$(this).attr("mood"));setMood($(this).attr("mood"))});$("a#updateMoodButton").click(function(a){updateMood()});$("a#cancelUpdateButton").click(function(a){logIt("cancelUpdateButton click");cancelUpdateAtStatus()});$("#toolButton").click(function(a){tools.open?
hideTools():showTools()});$("#signOutButton").click(function(a){signUserOut()});$("#signOutButton").on("touchstart",function(a){signUserOut()});$("#contactButton").click(function(a){hideAllSections();showContactForm()});$("#showRecentUpdatesButton").click(function(a){showRecentUpdates(3)});$("#showMoreUpdatesButton").click(function(a){showRecentUpdates(6)});$("#showAllUpdatesButton").click(function(a){showRecentUpdates(parseInt(me.updates.length))});$("#submitContactForm").click(function(a){a.preventDefault();
submitContactForm()});restyleJanrain();canvasPoints=[];$(window).resize(function(a){onViewportResize()});dotRadius=4;environment.mobileSize&&(dotRadius=5);logIt("init finished")}function getEnvironment(){environment.screenWidth=$(window).width();environment.screenHeight=$(window).height();700>environment.screenWidth?(logIt("mobile or tablet sized screen detected"),environment.mobileSize=!0):logIt("screen is larger than mobile size");environment.touchInput=!!("ontouchstart"in window)}
var janrainReady=!1,restyleInterval;
function restyleJanrain(){logIt("restyleJanrain running");$("#janrainEngageEmbed").css("visibility","hidden");$("#janrainEngageEmbed").css("margin-bottom","50px");$("#janrainEngageEmbed").css("margin-left","auto");$("#janrainEngageEmbed").css("margin-right","auto");$("#janrainEngageEmbed").css("min-height","400px");$("#janrainEngageEmbed").find("div").each(function(){$(this).attr("style","width: 100% !important;");$(this).css("text-align","center");$(this).css("font-family",'"Raleway", sans-serif;');
$(this).css("font-size","1em");$(this).css("color","#fff");$(this).css("border","none");$(this).css("font-weight","400");$(this).css("display","block");$(this).css("clear","both");$(this).css("background-color","transparent")});$("#janrainEngageEmbed").find("ul").attr("style","display: inline-block; margin:0px; padding:0px; list-style-type:none; width:190px !important; float:left");$(".janrainPage").find("li").attr("style","");$(".janrainPage").find("li").each(function(){$(this).attr("style","width: 160px");
$(this).css("height","30px");$(this).css("font-family",'"Raleway", sans-serif;');$(this).css("font-weight","400");$(this).css("background-color","transparent");$(this).css("background-image","none");$(this).css("padding","3px")});environment.mobileSize?$("#janrainProviderPages").attr("style","width: 100% !important"):$("#janrainProviderPages").attr("style","width: 400px !important");$("#janrainEngageEmbed").find("a").attr("style",'margin: 20px; display: block; height: 30px; font-size: 1em; background-color: transparent !important; color: rgba(255, 255, 255, 0.2); background-image:none;  font-weight: 400; font-family: "Raleway", sans-serif;');
$("#janrainEngageEmbed").find("a").hover(function(){$(this).attr("style",'margin: 20px; display: block; height: 30px; font-size: 1em; background-color: transparent !important; color: rgba(255, 255, 255, 0.2); background-image:none;  font-weight: 400; font-family: "Raleway", sans-serif;');$(this).find("span").attr("style",'font-size: 1em; font-family: "Raleway", sans-serif; font-weight: 400; color: rgba(255, 255, 255, 0.2) !important; margin: 3px');$(this).find("span").find("span").attr("style",'font-size: 1em; font-family: "Raleway", sans-serif; font-weight: 400; color: rgba(255, 255, 255, 0.2) !important; margin: 3px')},
function(){$(this).attr("style",'margin: 20px; display: block; height: 30px; font-size: 1em; background-color: transparent !important; color: rgba(255, 255, 255, 0.2); background-image:none;  font-weight: 400; font-family: "Raleway", sans-serif;');$(this).find("span").attr("style",'font-size: 1em; font-family: "Raleway", sans-serif; font-weight: 400; color: rgba(255, 255, 255, 1) !important; margin: 3px');$(this).find("span").find("span").attr("style",'font-size: 1em; font-family: "Raleway", sans-serif; font-weight: 400; color: rgba(255, 255, 255, 1) !important; margin: 3px')});
$("#janrainEngageEmbed").find("a").click(function(){$("#janrainEngageEmbed").css("visibility","hidden")});$("#janrainEngageEmbed").find("li").attr("style",'background-color: transparent !important; color: rgba(255, 255, 255, 0.2); background-image:none; font-weight: 400; font-family: "Raleway", sans-serif;');$("#janrainEngageEmbed").find("li").hover(function(){$(this).attr("style",'background-color: transparent !important; color: rgba(255, 255, 255, 0.2); background-image:none;  font-weight: 400; font-family: "Raleway", sans-serif;');
$(this).find("span").attr("style",'font-family: "Raleway", sans-serif; font-weight: 400; color: rgba(255, 255, 255, 0.2) !important; margin: 3px')},function(){$(this).attr("style",'background-color: transparent !important; color: rgba(255, 255, 255, 0.2); background-image:none; font-weight: 400; font-family: "Raleway", sans-serif;');$(this).find("span").attr("style",'font-family: "Raleway", sans-serif; font-weight: 400; color: rgba(255, 255, 255, 1) !important; margin: 3px')});$("#janrainEngageEmbed").find("li").find("span").attr("style",
'font-family: "Raleway", sans-serif; font-weight: 400; color: #fff !important; margin: 3px');$(".janrainContent").css("height","250px");$(".janrainContent").css("margin","0px");$(".janrainHeader").css("width","300px");$(".janrainHeader").css("margin","0px auto 0px auto");$(".janrainHeader").css("text-align","center");$(".janrainHeader").css("padding-top","20px");$(".janrainHeader div").html("Sign in or sign up via your favourite social media service:");environment.mobileSize?($("#janrainEngageEmbed").css("width",
"15em"),$("#janrainProviderPages").css("height","1000px"),$("#janrainProviderPages").css("width","100%"),$("#janrainProviders_0").attr("style",""),$("#janrainProviders_1").attr("style",""),$(".providers").css("width","30% !important"),$(".providers").css("display","inline-block"),$(".providers").css("list-style-type","none"),$(".providers").css("float","left"),$(".providers").css("margin-left","0em")):($("#janrainProviderPages").css("height","400px"),$("#janrainProviderPages").css("width","380px"),
$("#janrainProviderPages").css("margin","20px auto 20px auto"));$(".janrainSwitchAccountLink").attr("style","display:none !important");janrainReady=!0;logIt("finished restyleJanrain code");$("#janrainEngageEmbed").css("visibility","visible")}
(function(){function a(){janrain.ready=!0}"object"!==typeof window.janrain&&(window.janrain={});"object"!==typeof window.janrain.settings&&(window.janrain.settings={});janrain.settings.tokenUrl=baseURL+"/janrain_redirect.php";document.addEventListener?document.addEventListener("DOMContentLoaded",a,!1):window.attachEvent("onload",a);var b=document.createElement("script");b.type="text/javascript";b.id="janrainAuthWidget";b.src="https:"===document.location.protocol?"https://rpxnow.com/js/lib/moodoo/engage.js":
"http://widget-cdn.rpxnow.com/js/lib/moodoo/engage.js";var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)})();
function janrainWidgetOnload(){logIt("widget loaded");restyleJanrain();janrain.events.onProviderLoginStart.addHandler(function(a){logIt("Login Started")});janrain.events.onProviderLoginCancel.addHandler(function(a){logIt("Login Cancelled!");logIt("trying to close janrain window");janrain.engage.signin.modal.close();signUserOut()});janrain.events.onProviderLoginComplete.addHandler(function(a){logIt("Login complete - either successful or unsuccessful");logIt("trying to close janrain window");janrain.engage.signin.modal.close()});
janrain.events.onProviderLoginToken.addHandler(function(a){clearInterval(restyleInterval);logIt("got response: "+a.token);$.ajax({type:"POST",url:"janrain_auth.php",data:"token="+a.token,success:function(a,c,e){logIt("res="+a+", status="+c+", xhr="+e);for(var g in a)logIt("res["+g+"]="+a[g]);logIt("identifier: "+a.profile.identifier);logIt("displayName: "+a.profile.displayName);logIt("primaryKey: "+a.profile.primaryKey);a.profile.name&&logIt("givenName: "+a.profile.name.givenName);logIt("sending social info to server");
logIt("trying to close janrain window");janrain.engage.signin.modal.close();loadUser(null,a.profile)},error:function(a,c,e){logIt("error when sending token to janrain")}})})}
function loadUser(a,b){logIt("loadUser running; userID="+a+", socialProfile="+b);$("#communication").html("<h1>Loading your data...</h1>");showDiv("communication");a?(logIt("sending userID from browser to server, userID="+a),$.ajax({type:"POST",url:"moodoo_auth_main.php",data:{userID:a},success:function(a,b,g){logIt("userID data send success! server says: res="+a+", status="+b+", xhr="+g);logIt("php log:"+a.log);logIt("submitted query:"+a.query);logIt("create user query:"+a.createQuery);logIt("new user ID:"+
a.newuserID);logIt("query success:"+a.success);logIt("social ID:"+a.socialID);logIt("user ID:"+a.userID);logIt("firstName:"+a.firstName);logIt("lastName:"+a.lastName);logIt("email:"+a.email);logIt("publishSocial:"+a.publishSocial);logIt("publishToMoodoo:"+a.publishToMoodoo);logIt("allowLocation:"+a.allowLocation);logIt("reminder:"+a.reminder);logIt("updates:"+a.updates);me.ID=a.userID;me.socialID=a.socialID;me.firstName=a.firstName;me.lastName=a.lastName;me.email=a.email;me.publishSocial=a.publishSocial;
me.publishToMoodoo=me.publishToMoodoo;me.allowLocation=a.allowLocation;me.reminder=a.reminder;me.updates=a.updates;for(var f in a.updates)logIt("res.updates["+f+"].updateID="+a.updates[f].updateID);a.newuserID&&logIt("DETECTED NEW USER - CAN SEND TO GOOGLE FOR CONVERSION");onDataRefreshed()},error:function(a,b,g){logIt("ERROR! while trying to send cookie ID to server. data="+a+", status="+b+", xhr="+g);for(var f in a)logIt(f+"="+a[f])}})):b?(logIt("sending socialProfile from janrain to moodoo server, socialProfile.identifier="+
b.identifier),b.name&&(me.firstName=b.name.givenName,me.lastName=b.name.familyName),$.ajax({type:"POST",url:"moodoo_auth_main.php",data:{userID:a,firstName:me.firstName,lastName:me.lastName,socialID:b.identifier,email:b.email},success:function(a,b,g){logIt("socialProfile send success! server says: res="+a+", status="+b+", xhr="+g);for(var f in a)logIt("looking at data; res["+f+"]="+a[f]);logIt("submitted query:"+a.query);logIt("query success:"+a.success);logIt("new user ID:"+a.newuserID);logIt("user ID:"+
a.userID);logIt("social ID:"+a.socialID);logIt("name:"+a.name);logIt("firstName:"+a.firstName);a.givenName&&logIt("givenName:"+a.givenName);logIt("lastName:"+a.lastName);logIt("email:"+a.email);logIt("publishSocial:"+a.publishSocial);logIt("publishToMoodoo:"+a.publishToMoodoo);logIt("allowLocation:"+a.allowLocation);logIt("reminder:"+a.reminder);logIt("updates:"+a.updates);logIt("newUser:"+a.newUser);me.ID=a.userID;me.socialID=a.socialID;me.firstName=a.firstName;me.lastName=a.lastName;me.email=a.email;
me.publishSocial=a.publishSocial;me.publishToMoodoo=me.publishToMoodoo;me.allowLocation=a.allowLocation;me.reminder=a.reminder;me.updates=a.updates;for(var k in a.updates);a.newuserID&&(logIt("DETECTED NEW USER - CAN SEND TO GOOGLE FOR CONVERSION"),$(body).append('<div style="display:inline;"><img height="1" width="1" style="border-style:none;" alt="" src="//www.googleadservices.com/pagead/conversion/959257350/?label=tFlBCPyMslgQhra0yQM&amp;guid=ON&amp;script=0"/></div>'));onDataRefreshed()},error:function(a,
b,g){logIt("ERROR! while trying to send social ID to server. data="+a+", status="+b+", xhr="+g);for(var f in a)logIt(f+"="+a[f])}})):logIt("ERROR: neither cookie id nor socialProfile passed to loadUser function")}function onDataRefreshed(){dataRefreshed=!0;$("#tools").css("display","inline-block");showDiv("moodInput");createDisplay()}function showTools(){logIt("showTools running");$(".toolsButton").animate({opacity:1,width:"4em",padding:"0.5em 0.5em"},100,function(){tools.open=!0})}
function hideTools(){logIt("hideTools running");$(".toolsButton").animate({opacity:0,width:"0px",padding:"0px"},100,function(){tools.open=!1})}function signUserOut(){$("#tools").css("display","none");token=null;window.open(baseURL,"_self")}function showContactForm(){showDiv("contact")}function hideContactForm(){hideDiv("contact")}
function submitContactForm(){logIt("submitContactForm running, sending:"+$("#name").val()+","+$("#email").val()+","+$("#subject").val()+","+$("#message").val());$.ajax({type:"POST",url:"moodoo_mail.php",data:{contactFirstName:$("#name").val(),returnEmail:$("#email").val(),subject:$("#subject").val(),contactMessage:$("#message").val()},success:function(a,b,c){logIt("submitContactForm: contact form data sent.");logIt("res="+a.toString())}});hideContactForm();createDisplay();$("#communication").html=
"<p>Your message has been sent.</p>";showDiv("communication")}function setMood(a){logIt("setMood running");logIt("theMoods[mood]="+theMoods[a]);me.moodNum=a;getLocation();$("#statusLabel").html("Why are you feeling "+theMoods[a]+"?");hideDiv("moodInput","statusBox")}
function updateMood(){logIt("updateMood running");$("#communication").html("<h1>Updating your mood...</h1>");hideDiv("statusBox","communication");dataRefreshed=socialPublishFinished=!1;checkUpdateStatus();var a=escape($("#status").val());a?me.status=a:($("#status").val("Please enter a status to go with your mood."),hideDiv("communication","statusBox"));logIt("about to update status, me.status="+me.status);logIt("updating mood, me.publishSocial="+me.publishSocial);$.ajax({type:"POST",url:"updateMood.php",
data:{socialID:me.socialID,userID:me.ID,mood:me.moodNum,lat:me.lat,lng:me.lng,status:me.status,code:me.code},success:function(a,c,e){logIt("updateMood data sent successfully");updateMoodResponse(a)},error:function(a,c,e){logIt("ERROR! updateMood failed");$("#communication").html("<h1>Oops! Something went wrong.</h1><p>We couldn't talk to the Moodoo server. <br/>Please check your connection and try again in a few minutes.<br/> Your mood has not been updated.</p>");showDiv("communication");logIt("data="+
a+", status="+c+", xhr="+e);for(var g in a)logIt(g+"="+a[g])}});1==me.publishSocial?publishToSocial():socialPublishFinished=!0;$("#status").val("")}
function updateMoodResponse(a){logIt("updateMoodResponse running");logIt("res="+a);if(a){for(var b in a)logIt("res["+b+"]="+a[b]);1==a.moodUpdated?(logIt("Mood updated, refreshing data. me.ID="+me.ID),dataRefreshed=!1,loadUser(me.ID,null)):logIt("ERROR: Something wrong with the MySQL query, mood not updated in database!")}else logIt("ERROR: no data returned from updateMood script!")}var checkUpdateStatusTick=0;
function checkUpdateStatus(){logIt("checkUpdateStatus running");checkUpdateStatusTick++;updateMoodTimer=setTimeout("checkUpdateStatus()",100);socialPublishFinished&&dataRefreshed?(logIt("all processes complete"),clearTimeout(updateMoodTimer)):50<checkUpdateStatusTick?clearTimeout(updateMoodTimer):logIt("chaeckUpdateStatus tick:"+checkUpdateStatusTick+", socialPublishFinished="+socialPublishFinished+", dataRefreshed="+dataRefreshed)}
function cancelUpdateAtStatus(){logIt("cancelUpdateAtStatus running");$("#status").val("");hideDiv("statusBox","moodInput")}
function deleteUpdateConfirm(a){logIt("deleteUpdateConfirm running, updateNo="+a+", updateID="+me.updates[a].updateID);$("#updateBox"+a).toggleClass("transparent");$("#updateBox"+a).html('<span class="confirmDeleteSpan"><p>Are you sure you want to delete this update?</p> <a href="javascript:deleteUpdate('+parseInt(me.updates[a].updateID)+", "+a+')" class="confirmDeleteButton">Delete</a><a href="javascript:cancelUpdateDelete('+a+')" class="confirmDeleteButton">Cancel</a></span>');$("#updateBox"+a).css("text-align",
"center")}
function deleteUpdate(a,b){logIt("deleting  update no:"+a);$.ajax({type:"POST",url:"deleteMoodUpdate.php",data:{updateID:a},success:function(a,e,g){logIt("deleteUpdate data sent successfully");deleteUpdateResponse(a,b)},error:function(a,e,g){logIt("ERROR! deleteUpdate failed");$("#updateBox"+b).html('<span class="confirmDeleteSpan">Oops! Can\'t connect to Moodoo. Try again.<br/><a href="javascript:cancelUpdateDelete('+b+')" class="confirmDeleteButton" style="margin-left: 50px">Cancel</a></span>');logIt("data="+
a+", status="+e+", xhr="+g);for(var f in a)logIt(f+"="+a[f])}})}
function deleteUpdateResponse(a,b){logIt("deleteUpdateResponse running");a.moodUpdateDeleted?(logIt("update deleted, refreshing data. updateNo="+b),$("#updateBox"+b).animate({opacity:0,height:"0px"},350,function(){$("#updateBox"+b).css("display","none");dataRefreshed=!1;loadUser(me.ID,null)})):(logIt("server returned an error:"+a.error),$("#updateBox"+b).html('<span class="confirmDeleteSpan">Server can\'t find update! Moodoo gurus notified.<br/><a href="javascript:cancelUpdateDelete('+b+')" class="confirmDeleteButton" style="margin-left:50px">Cancel</a></span>'),
logError("Delete failed - update doesn't exist.",UserID,{updateNo:b}))}function cancelUpdateDelete(a){var b=makeUpdateBox(a);$("#updateBox"+a).html(b);$("#updateBox"+a).toggleClass("transparent");$("#updateBox"+a).css("text-align","left")}
var canvas,ctx,ctxMini,savedGraph,mooderatorHeight=300,viewportWidth=$(window).width()-110,mooderatorWidth=viewportWidth,backgroundColour1="#47709E",backgroundColour2="#FFFFFF",backgroundColour3="#3A5D7C",backgroundColour4="#FFFFFF",backgroundColour5="#FFFFFF",backgroundColour6="#47709E",startTime,timeSpan,borderColour="#666666",dragging,dragOffset,rightMargin,mooderatorWidthAtStartGesture=0,touchXAtStartGesture=0,baseXAtStartGesture=0,baseXAtTouchStart=0;$("#mooderatorGraph").addClass("grab");
var windowSpan,pixelWidth,baseX=0,miniBaseX=0,baseXRatio=0,sliderWidthRatio=.9,sliderPosRatio=0,mooderatorZoomRatio=1,recentUpdatesHeight=600,recentUpdateTableHeight=360,columnHeight=360,recentUpdatesHeightMobile=1200,recentUpdateTableHeightMobile=700,columnHeightMobile=700;
function showRecentUpdates(a){logIt("showRecentUpdates running");var b=parseInt(me.updates.length);logIt("noOfUpdates="+b+", noToShow="+a);environment.mobileSize&&(recentUpdatesHeight=recentUpdatesHeightMobile,f=recentUpdateTableHeightMobile,columnHeight=columnHeightMobile);if(3==a){logIt("showing 3 recents");$("#recentUpdateTable").html("");$("#showMoreUpdatesButton").css("display","block");$("#showRecentUpdatesButton").css("display","none");$("#showAllUpdatesButton").css("display","block");$("#recentUpdateTable").append('<div id="updateCol1" class="updatesColumn">');
for(var c=0;c<a;c++){var e=parseInt(b-c-1);logIt("loopNo="+e);var g='<span id="updateBox'+e.toString()+'" class="showUpdatesBox blur">'+makeUpdateBox(e)+"</span>";$("#updateCol1").append(g);$("updateBox"+parseInt(b-c).toString()).data("boxNumber",e);$("updateBox"+parseInt(b-c).toString()).data("updateID",me.updates[e].updateID)}environment.mobileSize?($("#recentUpdates").css("height","auto"),$("#recentUpdateTable").css("height","auto"),$("#updateCol1").css("height","auto")):($("#recentUpdates").animate({height:recentUpdatesHeight},
500),$("#recentUpdateTable").height(f),$("#updateCol1").height(columnHeight),370<$("#recentUpdateTable").width()&&$("#recentUpdateTable").animate({width:370},500))}else if(6==a){logIt("showing 6 updates");if(environment.mobileSize){$("#recentUpdateTable").css("height","auto");$("#recentUpdates").css("height","auto");for(c=3;c<a;c++)e=parseInt(b-c-1),logIt("loopNo="+e),g='<span id="updateBox'+e.toString()+'" class="showUpdatesBox blur">'+makeUpdateBox(e)+"</span>",$("#updateCol1").append(g);$("#showRecentUpdatesButton").css("display",
"block");$("#showAllUpdatesButton").css("display","block")}else $("#recentUpdates").animate({height:recentUpdatesHeight},500,function(){}),$("#recentUpdateTable").animate({width:760},500,function(){$("#recentUpdateTable").append('<div id="updateCol2" style="opacity:0" class="updatesColumn">');for(var c=3;c<a;c++){var e=parseInt(b-c-1);logIt("loopNo="+e);e='<span id="updateBox'+e.toString()+'" class="showUpdatesBox blur">'+makeUpdateBox(e)+"</span>";$("#updateCol2").append(e)}$("#updateCol2").height(columnHeight);
$("#updateCol2").animate({opacity:1},500,function(){});$("#showRecentUpdatesButton").css("display","block");$("#showAllUpdatesButton").css("display","block");$("#showMoreUpdatesButton").css("display","none")});$("#showMoreUpdatesButton").css("display","none")}else if(logIt("showing all updates"),environment.mobileSize){$("#recentUpdates").css("height","auto");$("#recentUpdateTable").css("height","auto");$("#updateCol1").css("height","auto");for(c=3;c<a;c++)e=parseInt(b-c-1),logIt("loopNo="+e),g='<span id="updateBox'+
e.toString()+'" class="showUpdatesBox blur">'+makeUpdateBox(e)+"</span>",$("#updateCol1").append(g);$("#updateCol1").css("height","auto");$("#showMoreUpdatesButton").css("display","none");$("#showRecentUpdatesButton").css("display","block");$("#showAllUpdatesButton").css("display","none")}else{var f=a/2*112;$("#recentUpdates").animate({height:f+200},500,function(){});$("#recentUpdateTable").animate({width:760,height:f},500,function(){console.log("test 3");$("#recentUpdateTable").append('<div id="updateCol2" style="opacity:0" class="updatesColumn">');
logIt("finished recentUpdateTable resize animation");for(var c=3;c<a;c++){var e=parseInt(b-c-1);logIt("loopNo="+e);e='<span id="updateBox'+e.toString()+'" class="showUpdatesBox blur">'+makeUpdateBox(e)+"</span>";console.log(" showing all updates; noToShow="+a+", noToShow%2 ="+a%2+", parseInt(noToShow/2 +2) ="+parseInt(a/2+2));0==parseInt(a)%2&&c<parseInt(a/2)?$("#updateCol1").append(e):0<a%2&&c<parseInt(a/2+1)?$("#updateCol1").append(e):$("#updateCol2").append(e)}$("#updateCol1").height(f);$("#updateCol2").height(f);
$("#updateCol2").animate({opacity:1},500);$("#showMoreUpdatesButton").css("display","none");$("#showRecentUpdatesButton").css("display","block");$("#showAllUpdatesButton").css("display","none")})}$("#recentUpdates").css("display","block");$("#recentUpdates").data("hidden",!1);$("#recentUpdates").css("visibility","visible");$("#recentUpdates").css("opacity",1)}
function makeUpdateBox(a){return'<span class="updateIcon" style="background-image: url(images/'+theMoods[me.updates[a].mood]+'_face.svg)"></span><span class="updateTitle" style="display:block; margin-top:10px">'+theMoods[me.updates[a].mood]+'</span><span class="updateDate" style="font-size:0.7em; margin-top: 5px; display:block">'+convertDate(me.updates[a].time)+'</span> <span class="recentUpdateBoxStatus">'+unescape(me.updates[a].status)+'</span><a class="deleteButton" onclick="deleteUpdateConfirm('+
a.toString()+')">x</a></span>'}
function drawMooderator(){viewportWidth=$(window).width()-110;environment.mobileSize&&(mooderatorHeight=300);var a=me.updates;$("#mooderatorGraph").attr("width",$(window).width()-100);$("#mooderatorGraph").attr("height",mooderatorHeight);$("#mooderatorGraph").css("display","block");$("#mooderatorGraph").css("width",$(window).width()-100+"px");$("#mooderatorGraph").css("margin","0px auto 0px auto");var b=a[0].seconds;timespan=a[a.length-1].seconds-b;startTime=b;(canvas=document.getElementById("mooderatorGraph"))?
(logIt("drawMooderator: canvas exists"),canvas.getContext?(logIt("drawMooderator: canvas.getContext exists"),ctx=canvas.getContext("2d"),drawGraph(a)):logIt("drawmooderator - ERROR - no getContext method on canvas element")):logIt("drawmooderator - ERROR -canvas isnt registered!")}
function drawSimpleGraph(a){logIt("drawSimpleGraph running");for(var b=[],c=1,e=0;e<a.length;e++)b[e]=(a[e].seconds-startTime)/timespan;ctx.clearRect(0,0,450,150);e=mooderatorHeight-30;ctx.lineWidth=.5;ctx.lineCap="round";ctx.lineJoin="round";var g=e/10;ctx.moveTo(baseX,e-a[0].mood*g);ctx.beginPath();canvasPoints=[];for(var f=0;f<a.length;f++){var k=b[f]*mooderatorWidth+baseX+10,h=b[f+1]*mooderatorWidth+baseX+10,p=10+e-a[f].mood*g;0>h||(2<h-k&&c++,ctx.lineTo(k,p),canvasPoints.push({x:k,y:p,number:f,
mood:a[f].mood,group:c}))}ctx.strokeStyle="red";ctx.stroke();for(a=ctx.lineWidth=0;a<canvasPoints.length;a++)b=parseInt(canvasPoints[a].mood),parseInt(canvasPoints[a].mood),ctx.fillStyle=colourArray[b],ctx.strokeStyle="rgba(255, 255, 255, 0)",ctx.lineWidth=0,drawSolidCircle(ctx,canvasPoints[a].x,canvasPoints[a].y,4);showDiv("mooderator")}
function drawGraph(a){logsOn=!1;logIt("drawGraph running");graphPoints=[];pointGroups=[[]];for(var b=0,c=0;c<a.length;c++)graphPoints[c]=(a[c].seconds-startTime)/timespan;var c=3*dotRadius,e=mooderatorHeight-30;ctx.lineWidth=.5;ctx.lineCap="round";ctx.lineJoin="round";var g=e/10;ctx.moveTo(baseX,e-a[0].mood*g);for(ctx.beginPath();0<canvasPoints.length;)canvasPoints.pop();for(var f=0;f<a.length;f++){logIt("drawGraph: MAIN LOOP. i="+f);var k=graphPoints[f]*mooderatorWidth+baseX+dotRadius,h=graphPoints[f+
1]*mooderatorWidth+baseX+dotRadius;if(graphPoints[f-1])var p=graphPoints[f-1]*mooderatorWidth+baseX+dotRadius;var q=10+e-a[f].mood*g;if(!(0>h)){var n=0,m=0,l,n=parseInt(k-p),m=parseInt(h-k);isNaN(n)&&(m<c&&(l="first"),m>c&&(l="none"));n<c&&(m<c&&(l="current"),m>c&&(l="current"));n>c&&(m<c&&(l="next"),m>c&&(l="none"));isNaN(m)&&(n<c&&(l="current"),n>c&&(l="none"));logIt("drawGraph-point "+f+": group type="+l);switch(l){case "next":h=parseInt(b)+1;logIt("drawGraph - placing  point "+f+" into group "+
h);pointGroups[h]||(pointGroups[h]=[]);pointGroups[h]||(pointGroups[h]=[]);pointGroups[h].push({x:k,y:q,number:null,mood:a[f].mood,time:a[f].time,inGroup:!0,pointGroup:h});drawGroupPoint(b);b++;break;case "first":case "current":logIt("drawGraph - placing  point "+f+" into group "+parseInt(b));pointGroups[b].push({x:k,y:q,number:null,mood:a[f].mood,time:a[f].time,inGroup:!0,pointGroup:parseInt(b)});f==a.length-1&&drawGroupPoint(b);break;default:drawGroupPoint(b),b++,ctx.lineTo(k,q),canvasPoints.push({x:k,
y:q,updateNumber:f,mood:a[f].mood,group:!1}),b++,pointGroups[b]||(pointGroups[b]=[]),pointGroups[b]=[]}}}ctx.strokeStyle="rgba(255, 255, 255, 1)";ctx.stroke();for(a=0;a<canvasPoints.length;a++)b=parseInt(canvasPoints[a].mood),parseInt(canvasPoints[a].mood),ctx.fillStyle=colourArray[b],b=canvasPoints[a].updateNumber?dotRadius:dotRadius+dotRadius/(environment.mobileSize?12:4)*parseFloat(canvasPoints[a].pointsInGroup),drawSolidCircle(ctx,canvasPoints[a].x,canvasPoints[a].y,b);logIt("drawGraph complete - no of updates="+
me.updates.length+", no of pointGroups="+pointGroups.length+", no of canvasPoints="+canvasPoints.length);ctx&&(savedGraph=ctx.getImageData(0,0,mooderatorWidth+50,mooderatorHeight+50));logIt("just saved graph state: savedGraph="+savedGraph);logsOn=!0}
function drawGroupPoint(a){logIt("drawGroupPoint - rendering group "+a);if(0<pointGroups[a].length){var b=0,c=0,e=0,g=0,f=0,k=0,h;h=[];for(z in pointGroups[a])b+=pointGroups[a][z].x,e+=pointGroups[a][z].y,f+=parseInt(pointGroups[a][z].mood),h.push(pointGroups[a][z].mood);logIt("drawGroupPoint: tempXTotal="+b);c=b/parseInt(pointGroups[a].length);logIt("drawGroupPoint: pointGroups[currentPointGroup].length="+pointGroups[a].length);logIt("drawGroupPoint: tempXAvg="+c);g=e/parseInt(pointGroups[a].length);
logIt("drawGroupPoint: tempYAvg="+g);logIt("drawGroupPoint: tempYAvg="+g);b=parseInt(pointGroups[a].length);logIt("drawGroupPoint: pointGroupLength="+b);logIt("drawGroupPoint: tempMoodTotal="+f);k=Math.floor(f/b);tempMaxMood=Math.max.apply(Math,h);tempMinMood=Math.min.apply(Math,h);f=convertDate(pointGroups[a][0].time);h=convertDate(pointGroups[a][b-1].time);logIt("drawGroupPoint: tempMoodAvg="+k);logIt("drawGroupPoint: tempMaxMood"+tempMaxMood);logIt("drawGroupPoint: tempMinMood"+tempMinMood);ctx.lineTo(c,
g);parseInt(canvasPoints.length+1);canvasPoints.push({x:c,y:g,updateNumber:null,mood:k,maxMood:tempMaxMood,minMood:tempMinMood,avgMood:k,earliestDate:f,latestDate:h,group:!0,pointsInGroup:pointGroups[a].length,groupNo:a})}}
function drawMooderatorControl(){logIt("drawMooderatorControl running");$("#miniGraph").attr("width",viewportWidth);$("#miniGraph").attr("height",80);$("#miniGraph").width(viewportWidth);$("#miniGraphSlider").width()>viewportWidth&&$("#miniGraphSlider").width(viewportWidth);$("#miniGraphSlider").css("margin-left","auto");$("#miniGraphSlider").css("margin-right","auto");$("#miniGraph").css("display","block");$("#miniGraph").css("margin","0px auto 100px auto");(canvasMini=document.getElementById("miniGraph"))?
canvasMini.getContext?(ctxMini=canvasMini.getContext("2d"),drawMiniGraph(me.updates)):logIt("drawmooderator - ERROR - no getContext method on canvasMini element"):logIt("drawmooderator - ERROR -canvasMini isnt registered!")}
function drawMiniGraph(a){logIt("drawMiniGraph running");for(var b=[],c=0;c<a.length;c++)b[c]=(a[c].seconds-startTime)/timespan;ctxMini.clearRect(0,0,450,150);ctxMini.lineWidth=.5;ctxMini.lineCap="round";ctxMini.lineJoin="round";ctxMini.moveTo(miniBaseX,50-5*a[0].mood);ctxMini.beginPath();canvasMiniPoints=[];for(c=0;c<a.length;c++){var e=b[c]*viewportWidth+miniBaseX+5,g=60-5*a[c].mood;0>b[c+1]*viewportWidth+miniBaseX+5||(ctxMini.lineTo(e,g),canvasMiniPoints.push({x:e,y:g,number:c,mood:a[c].mood}))}ctxMini.strokeStyle=
"rgba(255, 255, 255, 1)";ctxMini.stroke()}
function setMiniGraphSlider(){logIt("setMiniGraphSlider running");$("#miniGraphSlider").css("margin","0px 0px");$("#miniGraphSlider").offset({top:$("#miniGraphSlider").offset().top,left:55});$("#sliderHandleRight").mousedown(function(a){onMouseDownSliderRight(a)});$("#sliderHandleLeft").mousedown(function(a){logIt("mousedown on slider left handle");onMouseDownSliderLeft(a)});$("#miniGraphSlider").mousedown(function(a){logIt("mousedown on slider body");onMouseDownSliderBody(a)});$(document).mouseup(function(a){onMouseUpDocument(a)});
$("#wrapper").on("touchstart",function(a){logIt("touchstart on wrapper");onMouseUpDocument(a)})}function removeSliderMouseEvents(){$("#miniGraphSlider").off("mousedown");$("#miniGraphSlider").off("mousemove");$("#sliderHandleRight").off("mousedown");$("#sliderHandleLeft").off("mousedown")}
function zoomIn(){logIt("zoomIn running, mooderatorWidth="+mooderatorWidth);var a=mooderatorWidth,b=Math.abs(baseX)+($("#mooderatorGraph").width()-10)/2;mooderatorWidth*=1.25;var c=b/a*mooderatorWidth,e=0;logIt("baseX="+baseX);e=c-b;logIt("baseX="+baseX);logIt("oldMooderatorWidth="+a);logIt("mooderatorWidth="+mooderatorWidth);logIt("oldCentre="+b);logIt("newCentre="+c);logIt("scrollAmount="+e);scrollRight(e)}
function zoomOut(){logIt("zoomOut running, mooderatorWidth="+mooderatorWidth);var a=mooderatorWidth,b=Math.abs(baseX)+($("#mooderatorGraph").width()-10)/2;mooderatorWidth*=.8;mooderatorWidth<$("#mooderatorGraph").width()-10&&(mooderatorWidth=$("#mooderatorGraph").width()-10);scrollLeft(b-b/a*mooderatorWidth)}
function zoomToSlice(a,b){logIt("zoomTo running, mooderatorWidth="+mooderatorWidth+", sliceWidth="+a+", slicePos="+b);Math.abs(baseX);$("#mooderatorGraph").width();mooderatorWidth=viewportWidth*viewportWidth/a;var c=0,c=mooderatorWidth/viewportWidth*b;baseX=-c;baseXRatio=c/$(window).width();drawMooderator()}
function zoomChangeTouch(a,b){logIt("zoomChangeTouch: gestureScale="+a+", gestureX="+b);logIt("zoomChangeTouch: gestureScale*mooderatorWidth="+a*mooderatorWidth);var c=0;logIt("zoomChangeTouch: baseXAtTouchStart="+baseXAtTouchStart);logIt("zoomChangeTouch: mooderatorWidthAtStartGesture="+mooderatorWidthAtStartGesture);logIt("zoomChangeTouch: touchMidPointAtStartGesture="+touchMidPointAtStartGesture);mooderatorWidth=mooderatorWidthAtStartGesture*a;logIt("zoomChangeTouch: new mooderatorWidth="+mooderatorWidth);
mooderatorWidth<$("#mooderatorGraph").width()-10&&(mooderatorWidth=$("#mooderatorGraph").width()-10);logIt("zoomChangeTouch: widthDifference="+(mooderatorWidthAtStartGesture-mooderatorWidth));logIt("zoomChangeTouch: midPointOnGraphDiv="+touchMidPointAtStartGesture);c=touchMidPointAtStartGesture-baseXAtTouchStart;logIt("zoomChangeTouch: midPointOnWholeGraph="+c);var e=c*a;logIt("zoomChangeTouch: newMidPoint="+e);c=e-c;logIt("zoomChangeTouch: scrollAmount="+c);scrollGraph(c)}
function scrollGraph(a){logIt("scrollGraph: amount="+a);logIt("scrollGraph: old baseX="+baseX);a||(a=0);baseX=baseXAtTouchStart-a;0<=baseX&&(baseX=0);logIt("scrollGraph: new baseX="+baseX);logIt("scrollGraph: baseX+mooderatorWidth="+parseFloat(baseX+mooderatorWidth));logIt('scrollGraph: $("#mooderatorGraph").width()='+$("#mooderatorGraph").width());parseFloat(baseX+mooderatorWidth)<=$("#mooderatorGraph").width()&&(baseX=parseFloat($("#mooderatorGraph").width()-mooderatorWidth));drawMooderator()}
function createMoodPie(a){logIt("createMoodPie running");noOfUpdates=me.updates.length;logIt("noOfUpdates="+noOfUpdates);for(var b=[0,0,0,0,0,0,0,0,0,0],c=[],e=0;e<me.updates.length;e++){var g=parseInt(me.updates[e].mood);b[g]+=1}logIt("moodFrequency="+b);for(var f in b)0<b[f]?(e=parseInt(b[f])/noOfUpdates,c.push(Object({number:e,colour:colourArray[f]}))):c.push(Object({number:0,colour:null}));logIt("pieSlicePercentages="+c);logIt("createMoodPie: viewportWidth="+viewportWidth);b=getPieWidth();$("#moodPie").data("myHeight",
b+300);$("#moodPieGraph").attr("width",b);$("#moodPieGraph").attr("height",b);$("#moodPieGraph").css("margin-left","auto");$("#moodPieGraph").css("margin-right","auto");logIt("pieWidth="+b);drawPie(c,b/2,a);environment.mobileSize||($("#moodPieLabel").css("top",-(b/2)-75+"px"),$("#moodPieLabel").css("left",$("#moodPieGraph").offset().left+b/2-75+"px"));logIt("highlight="+a);void 0!=a&&0<c[a].number?($("#moodPieLabel #moodIcon").css("background-image","url(images/"+theMoods[a]+"_face.svg)"),$("#moodPieLabel #moodTextLabel").html(theMoods[a]+
"<br/>"),a=Math.floor(100*c[a].number),$("#moodPieLabel #percentage").html('<span style="font-size:3em">'+a+"%</span><br/> of updates")):($("#moodPieLabel #moodIcon").css("background-image","none"),$("#moodPieLabel #moodTextLabel").html(""),$("#moodPieLabel #percentage").html(""))}
function drawPie(a,b,c){logIt("drawPie running; theRadius="+b);var e=document.getElementById("moodPieGraph");e.imageSmoothingEnabled=!0;e.getContext&&(pieContext=e.getContext("2d"));pieContext.lineWidth=1;pieContext.lineCap="round";pieContext.lineJoin="round";pieContext.save();pieContext.beginPath();pieContext.arc(b,b,b,0,2*Math.PI,!0);pieContext.arc(b,b,environment.mobileSize?b/2:b/3,0,2*Math.PI,!1);pieContext.closePath();pieContext.clip();for(var g=e=0;g<a.length;g++)if(0<a[g].number){pieContext.beginPath();
pieContext.moveTo(b,b);var f=pieContext.createLinearGradient(0,0,0,300);f.addColorStop(0,a[g].colour);f.addColorStop(1,"#000000");pieContext.fillStyle=a[g].colour;f=2*Math.PI*a[g].number;pieContext.arc(b,b,b,e-.01,e+f+.01,!1);pieContext.closePath();pieContext.fill();void 0!=c&&g==c&&(pieContext.fillStyle="rgba(255,255, 255, 0.2)",pieContext.arc(b,b,b,e-.01,e+f+.01,!1),pieContext.closePath(),pieContext.fill());e+=f}showDiv("moodPie")}
function createDisplay(a){logIt("createDisplay running; me.updates="+me.updates);me.updates?1<me.updates.length?($("#communication").html("<h1>Hey, "+me.firstName+", how are you feeling right now?</h1>"),showDiv("communication"),3<me.updates.length&&showRecentUpdates(3),drawMooderator(),$("#graphHelp").html("You can zoom in on the graph by using pinch-zoom."),environment.touchInput||(drawMooderatorControl(),$("#graphHelp").html("You can zoom in on the graph by dragging the white handles<br/> on the mini-graph below:")),
createMoodPie(null)):($("#communication").html("<h1>Less than 2 Mood Updates</h1><p>Hey, "+me.firstName+", it looks like you've updated your mood less than twice so far. To really see what Moodoo can do, let us know how you're feeling now!</p>"),showDiv("communication")):($("#communication").html("<h1>No Mood Updates</h1><p>Hey, "+me.firstName+", it looks like you haven't done any mood updates yet. To get started with Moodoo, let us know how you're feeling now!</p>"),showDiv("communication"));environment.touchInput||
setMiniGraphSlider();showDiv("moodInput");showDiv("tools");showDiv("mooderator");showDiv("communication");hideDiv("auth")}function getPieWidth(){getEnvironment();return environment.screenHeight>environment.screenWidth?parseFloat(1.1*viewportWidth):parseFloat(.6*viewportWidth)}
function onViewportResize(){logIt("onViewportResize running");var a=$(window).width()-110,b=$(window).width()*sliderWidthRatio,c=a*sliderPosRatio,e=a*mooderatorZoomRatio,g=a*baseXRatio;logIt("newSliderWidth="+b+", newSliderPos="+c+", mooderatorZoomRatio="+mooderatorZoomRatio);$("#miniGraphSlider").css("width",b+"px");$("#miniGraphSlider").offset({top:$("#miniGraphSlider").offset().top,left:c});logIt("viewportResize: pieWidth="+f);$("#moodPieLabel").css("top",-(f/2)-75+"px");$("#moodPieLabel").css("left",
$("#moodPieGraph").offset().left+f/2-75+"px");mooderatorWidth=e;viewportWidth=a;logIt("viewportResize: viewportWidth="+viewportWidth);var f=getPieWidth();baseX=-g;me.updates&&1<me.updates.length&&(drawMooderator(),environment.touchInput||drawMooderatorControl());showDiv("communication")}function onMouseOverGraph(a){logIt("mouseover on graph");$("#mooderatorGraph").mousemove(function(a){onMouseMoveGraph(a)})}
function onMouseOutGraph(a){logIt("onMouseOutGraph running");$("#mooderatorGraph").off("mousemove",$("#mooderatorGraph"),onMouseMoveGraph)}function onMouseMoveGraph(a){logIt("onMouseMoveGraph");ctx.putImageData(savedGraph,0,0);var b=$("#mooderatorGraph").offset();testHitGraphDot({x:a.pageX-b.left,y:a.pageY-b.top})}
function testHitGraphDot(a){for(var b=!1,c=5*dotRadius,e=0;e<canvasPoints.length;e++){var g=Math.round(canvasPoints[e].x),f=Math.round(canvasPoints[e].y);g>a.x-c&&g<a.x+c&&f>a.y-c&&f<a.y+c&&(logIt("hit"),b=!0,showToolTip(canvasPoints[e].x,canvasPoints[e].y,canvasPoints[e].updateNumber,e));1!=b&&(ctx.putImageData(savedGraph,0,0),hideToolTip())}}var touchStartX=0,touchMoveX=0,multiTouchDistanceAtStart=0,multiTouchDistanceAtTouchMove=0,currentMultiTouchRatio=0;
function onTouchStartGraph(a){logIt("onTouchStartGraph");navigator.userAgent.match(/Android/i)&&touchEvent.preventDefault();var b=a.originalEvent.targetTouches.length;logIt("onTouchStartGraph: noOfTouches="+b);baseXAtTouchStart=baseX;logIt("onTouchStartGraph: baseXAtTouchStart="+baseXAtTouchStart);if(1<b){var c=parseFloat(a.originalEvent.targetTouches[0].pageX-a.target.offsetLeft),b=parseFloat(a.originalEvent.targetTouches[b-1].pageX-a.target.offsetLeft);parseFloat(a.originalEvent.targetTouches[0].pageY-
a.target.offsetTop);mooderatorWidthAtStartGesture=mooderatorWidth;touchMidPointAtStartGesture=c;baseXAtStartGesture=baseX;multiTouchDistanceAtStart=b-c;logIt("onTouchStartGraph: multiTouchDistanceAtStart="+multiTouchDistanceAtStart)}else touchStartX=parseFloat(a.originalEvent.targetTouches[0].pageX-a.target.offsetLeft),touchStartY=parseFloat(a.originalEvent.targetTouches[0].pageY-a.target.offsetTop),logIt("touchStartX="+touchStartX),multiTouchDistanceAtStart=null,testHitGraphDot({x:touchStartX,y:touchStartY})}
function onTouchMoveGraph(a){logIt("onTouchMoveGraph running");touchMoveX=parseFloat(a.originalEvent.targetTouches[0].pageX-a.target.offsetLeft);logIt("onTouchMoveGraph: touchMoveX="+touchMoveX);scrollAmount=touchStartX-touchMoveX;logIt("onTouchMoveGraph: scrollAmount="+scrollAmount);scrollGraph(scrollAmount);logIt("onTouchMoveGraph: e.originalEvent.targetTouches.length="+a.originalEvent.targetTouches.length)}function onTouchEndGraph(a){logIt("onTouchEndGraph")}
function onTouchCancelGraph(a){logIt("onTouchCancelGraph")}function onGestureStartGraph(a){a.preventDefault();$("#mooderatorGraph").off("touchmove");logIt("onGestureStartGraph: touch gesture start");mooderatorWidthAtStartGesture=mooderatorWidth;touchMidPointAtStartGesture=a.originalEvent.layerX;baseXAtStartGesture=baseX}function onGestureEndGraph(a){a.preventDefault();logIt("onGestureEndGraph: touch gesture end");$("#mooderatorGraph").on("touchmove",onTouchMoveGraph)}
function onGestureChangeGraph(a){a.preventDefault();logIt("onGestureChangeGraph: touch gesture change");zoomChangeTouch(a.originalEvent.scale,a.originalEvent.layerX)}function onMouseDownSliderLeft(a){logIt("mousedown on slider left handle");a.preventDefault?a.preventDefault():a.returnValue=!1;a.stopPropagation&&a.stopPropagation();rightMargin=$(window).width()-$("#miniGraphSlider").offset().left-$("#miniGraphSlider").width()-50;$(document).mousemove(function(a){onMouseMoveSlider(a,"left")})}
function onMouseDownSliderRight(a){logIt("mousedown on slider right handle");a.preventDefault?a.preventDefault():a.returnValue=!1;a.stopPropagation&&a.stopPropagation();rightMargin=$(window).width()-$("#miniGraphSlider").offset().left-$("#miniGraphSlider").width()-50;$(document).mousemove(function(a){onMouseMoveSlider(a,"right")});$(document).on("touchMove",function(a){onTouchMoveSlider(a,"right")})}
function onMouseDownSliderBody(a){logIt("mousedown on slider body");a.preventDefault?a.preventDefault():a.returnValue=!1;a=a.originalEvent.touches?a.originalEvent.touches[0].pageX-$("#miniGraph").offset().left:a.pageX-$("#miniGraph").offset().left;$("#miniGraphSlider").css("cursor"," -webkit-grabbing");dragOffset=a-$("#miniGraphSlider").offset().left;$(document).mousemove(function(a){onMouseMoveSlider(a,null)});$(document).on("touchMove",function(a){onTouchMoveSlider(a,null)})}
function onMouseMoveSlider(a,b){a.preventDefault?a.preventDefault():a.returnValue=!1;var c;c=a.originalEvent.touches?a.originalEvent.touches[0].pageX-$("#miniGraph").offset().left:a.pageX-$("#miniGraph").offset().left;logIt("onMouseMoveSlider, e.pageX="+a.pageX+", e.pageY="+a.pageY);if("left"==b)-5<c&&($("#miniGraphSlider").css("margin","0px"),$("#miniGraphSlider").offset({top:$("#miniGraphSlider").offset().top,left:c+$("#miniGraph").offset().left}),logIt("mousemove left handle, rightMargin="+rightMargin),
$("#miniGraphSlider").css("width",$("#miniGraph").width()-c-rightMargin+"px"));else if("right"==b){if(logIt("mousemove; over halfway"),c<$("#miniGraph").width()+10){var e=parseInt($("#miniGraphSlider").offset().left),g=$("#miniGraph").width()-c,f=c-e+$("#miniGraph").offset().left;logIt("minigraph width="+$("#miniGraph").width()+", originalMargin="+e+", endOffset="+g+", newWidth="+f);$("#miniGraphSlider").css("width",f+"px");$("#miniGraphSlider").offset({top:$("#miniGraphSlider").offset().top,left:e})}}else logIt("dragging whole bar; xpos="+
c+" ,dragOffset="+dragOffset),e=c-dragOffset+$("#miniGraph").offset().left,logIt("newMargin="+e),g=$("#miniGraph").offset().left-5,f=$("#miniGraph").width()+$("#miniGraph").offset().left+10,e>g&&$("#miniGraphSlider").width()+e<f&&$("#miniGraphSlider").offset({top:$("#miniGraphSlider").offset().top,left:e});zoomToSlice($("#miniGraphSlider").innerWidth(),$("#miniGraphSlider").offset().left-$("#miniGraph").offset().left);logIt("mousemove on slider, xpos="+c)}
function onMouseOverPie(a){logIt("onMouseOverPie running");$("#moodPieGraph").mousemove(function(a){onMouseMovePie(a)})}function onMouseOutPie(a){logIt("onMouseOutPie running");$("#moodPieGraph").off("mousemove",$("#moodPieGraph"),onMouseMovePie);$("#moodPieLabel #moodIcon").css("background-image","none");$("#moodPieLabel #moodTextLabel").html("");$("#moodPieLabel #percentage").html("")}
function onMouseMovePie(a){logIt("onMouseMovePie running");var b=$("#moodPieGraph").offset(),c=a.pageX-b.left;a=a.pageY-b.top;logIt("x:"+c+", y:"+a);c=pieContext.getImageData(c,a,1,1).data;c="#"+("000000"+rgbToHex(c[0],c[1],c[2])).slice(-6);logIt("hex="+c);logIt("colourArray.indexOf(hex)="+colourArray.indexOf(c));logIt("rolled over "+theMoods[colourArray.indexOf(c)]);-1==highlightArray.indexOf(c)&&-1!=colourArray.indexOf(c)&&createMoodPie(colourArray.indexOf(c))}
function onMouseUpDocument(a){logIt("mouseup");a.preventDefault?a.preventDefault():a.returnValue=!1;$(document).off("mousemove");$(document).off("touchmove");$("#miniGraphSlider").off("mousemove");$("#miniGraphSlider").off("touchmove");$("#miniGraphSlider").css("cursor"," -webkit-grab");sliderWidthRatio=$("#miniGraphSlider").width()/$(window).width();sliderPosRatio=$("#miniGraphSlider").offset().left/($(window).width()-110);mooderatorZoomRatio=mooderatorWidth/($(window).width()-110);logIt("at mouseup, sliderWidthRatio="+
sliderWidthRatio+", miniGraphSlider.offset().left="+$("#miniGraphSlider").offset().left+", sliderPosRatio="+sliderPosRatio);zoomToSlice($("#miniGraphSlider").innerWidth(),$("#miniGraphSlider").offset().left-$("#miniGraph").offset().left);tools.open&&(logIt("tools open, closing tools"),hideTools(),tools.open=!1)}
function showToolTip(a,b,c,e){logIt("showToolTip running; updateNumber="+c+", canvasNumber="+e+" $('#mooderatorGraph').offset().left="+$("#mooderatorGraph").offset().left+"; posX="+a+"; posY="+b);$("#mooderatorPopUpLabel").css("visibility","visible");if(null==c)$("#mooderatorPopUpLabel").html('<table><tr><td colspan = "2">Group of '+canvasPoints[e].pointsInGroup+' updates </td></tr><tr><td colspan = "2">From '+canvasPoints[e].earliestDate+'</td></tr><tr><td colspan = "2">to '+canvasPoints[e].latestDate+
'</td></tr><tr><td>Highest Mood</td><td> <img class="groupMoodIcon" src="images/'+theMoods[canvasPoints[e].maxMood]+'_face.svg"/></td></tr><tr>  <td>Lowest Mood</td><td> <img class="groupMoodIcon" src="images/'+theMoods[canvasPoints[e].minMood]+'_face.svg"/></td></tr><tr><td>Average</td><td><img class="groupMoodIcon" src="images/'+theMoods[canvasPoints[e].avgMood]+'_face.svg"/></td></tr></table>');else{c=parseInt(c);logIt("arrayIndex="+c);logIt("me.updates[arrayIndex].status="+me.updates[c].status);
var g=me.updates[c].mood,f=convertDate(me.updates[c].time);$("#mooderatorPopUpLabel").html("<span id='popUpTime'>"+f+"</span><span id='labelRoundBox' style='background-color:"+colourArray[canvasPoints[e].mood]+"'><img class='popUpMoodIcon' src='images/"+theMoods[canvasPoints[e].mood]+"_face.svg'/>"+theMoods[canvasPoints[e].mood]+"</span><span id='labelStatus'>"+unescape(me.updates[c].status+"</span>"))}environment.mobileSize?($("#mooderatorPopUpLabel").css("text-align","left"),$("#mooderatorPopUpLabel").css("margin-left",
"auto"),$("#mooderatorPopUpLabel").css("margin-right","auto")):($("#mooderatorPopUpLabel").css("height","auto"),$("#mooderatorPopUpLabel").css("top",$("#mooderatorGraph").offset().top),a>$(window).width()/2?(logIt("popUpLabel is in left half of window"),$("#mooderatorPopUpLabel").css("text-align","right"),$("#mooderatorPopUpLabel").css("margin-left",$("#mooderatorGraph").offset().left+a-30-$("#mooderatorPopUpLabel").width()+"px")):($("#mooderatorPopUpLabel").css("text-align","left"),$("#mooderatorPopUpLabel").css("margin-left",
$("#mooderatorGraph").offset().left+a-10+"px")));$("#mooderatorPopUpLabel").css("display","block");3<g&&6>g&&$("#labelRoundBox").css("color","#000");$("#mooderatorPopUpLabel").css("visibility","visible");highlightGraphPoint(e,a,b)}function hideToolTip(){$("#mooderatorPopUpLabel").css("visibility","hidden");environment.mobileSize&&$("#mooderatorPopUpLabel").css("display","none")}
function highlightGraphPoint(a,b,c){logIt("highlightGraphPoint running, canvasNumber="+a+", dotRadius="+dotRadius);ctx.putImageData(savedGraph,0,0);var e;e=environment.mobileSize?8:4;a=canvasPoints[a].pointsInGroup?dotRadius+dotRadius/e*parseFloat(canvasPoints[a].pointsInGroup):dotRadius;ctx.fillStyle="rgba(255, 255, 255, 0)";ctx.strokeStyle="rgba(255, 255, 255, 1)";ctx.lineWidth=.9*dotRadius;ctx.moveTo(b,c);drawSolidCircle(ctx,b,c,a)}
var gl,geocoder,geocoder2,locationTimer,timeSinceLocationQuery=0;function locationTimeoutCheck(){logIt("locationTimeoutCheck tick");timeSinceLocationQuery+=100;1E4<timeSinceLocationQuery?stopLocationTimer():locationTimer=setTimeout("locationTimeoutCheck()",100)}function stopLocationTimer(){logIt("stopLocationTimer running");clearTimeout(locationTimer);timeSinceLocationQuery=0}
function getLocation(){logIt("getLocation running");locationTimeoutCheck();Modernizr.geolocation?(logIt("Modernizr.geolocation=true"),gl=navigator.geolocation,gl.getCurrentPosition(recordPosition,function(a){logIt("geolocation error! error="+a);stopLocationTimer()},{maximumAge:Infinity,timeout:6E3})):(logIt("cant get geolocation"),stopLocationTimer())}function manualLocate(){logIt("manualLocate running");showDiv("manualLocation")}
function findMe(){logIt("findMe running");var a=$("#address").value;logIt("theAddress="+a);encodeAddress(a)}
function encodeAddress(a){logIt("encodeAddress running");$("#communication").html("Attempting to get your location from your address, please wait...<br/>");geocoder=new google.maps.Geocoder;geocoder.geocode({address:a},function(a,c){if(c==google.maps.GeocoderStatus.OK){var e=a[0].geometry.location;logIt("geocoding successful; lat="+e.lat()+", lng="+e.lng());me.lat=e.lat();me.lng=e.lng();e=new google.maps.LatLng(me.lat,me.lng);logIt("calling getAddress from encodeAddress");getAddress(e)}else logIt("Geocode was not successful for the following reason: "+
c);stopLocationTimer()})}function cancelUpdateAtGeocode(){$("#locationBox").css("display","none")}function updateWithoutLocation(){$("#changeLocationButton").css("display","none")}function recordPosition(a){logIt("recordPosition running");me.lat=a.coords.latitude;me.lng=a.coords.longitude;a=new google.maps.LatLng(me.lat,me.lng);stopLocationTimer();logIt("calling getAddress from recordPosition");getAddress(a)}
function getAddress(a){logIt("getAddress running; latlng="+a);var b=" ";geocoder2=new google.maps.Geocoder;a&&geocoder2.geocode({latLng:a},function(a,e){e==google.maps.GeocoderStatus.OK?(a[0]?(b=a[2].formatted_address,logIt("returnedAddress="+b)):logIt("reverse geocode: No results found"),$("#changeLocationButton").css("display","block")):logIt("Geocoder failed due to: "+e)})}
function publishToSocial(){logIt("publishToSocial running");logIt("me.moodNum="+me.moodNum);logIt("me.mood="+me.mood);socialPublishFinished=!0}function logIt(a){logsOn&&console.log(a)}function validateNumeric(a){var b=!0,c=/^[0-9 +]+$/;a?a.match(c)||(b=!1):b=!1;return b}
function hideAllSections(){$(".section").each(function(a){logIt("hideAllSections: hiding section "+$(this).attr("id")+"via jquery class loop");0==$(this).data("hidden")&&($(this).data("hidden",!0),logIt("hiding section "+$(this).attr("id")),0<$(this).outerHeight()&&$(this).data("myHeight",$(this).height()),$(this).animate({top:"-150",opacity:0},500,function(){$(this).css("visibility","hidden");$(this).animate({height:"0",marginTop:"0"},500,function(){})}))})}
function showDiv(a){$("#"+a).data("hidden")&&($("#"+a).data("hidden",!1),logIt("showing div "+a),$("#"+a).css("display","block"),logIt("$(#"+a+').css("display")='+$("#"+a).css("display")),logIt("$(#"+a+').data("myHeight")='+$("#"+a).data("myHeight")),$("#"+a).animate({height:$("#"+a).data("myHeight"),marginTop:20},500,function(){$("#"+a).css("visibility","visible");2>$("#"+a).height&&$("#"+a).css("height","auto");$("#"+a).animate({top:"0px",opacity:1},500,function(){logIt("$(#"+a+').css("display")='+
$("#"+a).css("display"))})}))}var divToShow;
function hideDiv(a,b){divToShow=b?b:null;0==$("#"+a).data("hidden")?($("#"+a).data("hidden",!0),logIt("hiding div "+a+", swapper="+b),2<$("#"+a).outerHeight()&&$("#"+a).data("myHeight",$("#"+a).outerHeight()),logIt("$(#"+a+').data("myHeight")='+$("#"+a).data("myHeight")),$("#"+a).animate({top:"-150",opacity:0},500,function(){logIt("hideDiv animation finished. swapper= "+divToShow);$("#"+a).css("visibility","hidden");$("#"+a).animate({height:"0",marginTop:"0"},500,function(){$("#"+a).css("display",
"none");divToShow&&showDiv(divToShow)})})):showDiv(divToShow)}function roundRect(a,b,c,e,g,f,k,h){"undefined"==typeof h&&(h=!0);"undefined"===typeof f&&(f=5);a.beginPath();a.moveTo(b+f,c);a.lineTo(b+e-f,c);a.quadraticCurveTo(b+e,c,b+e,c+f);a.lineTo(b+e,c+g-f);a.quadraticCurveTo(b+e,c+g,b+e-f,c+g);a.lineTo(b+f,c+g);a.quadraticCurveTo(b,c+g,b,c+g-f);a.lineTo(b,c+f);a.quadraticCurveTo(b,c,b+f,c);a.closePath();h&&a.stroke();k&&a.fill()}
function drawSolidCircle(a,b,c,e){a.beginPath();a.arc(b,c,e,0,2*Math.PI,!1);a.closePath();a.stroke();a.fill()}function getParameterByName(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=(new RegExp("[\\?&]"+a+"=([^&#]*)")).exec(location.search);return null==a?"":decodeURIComponent(a[1].replace(/\+/g," "))}
function convertDate(a){logIt("dateString="+a);dateArray=a.split(" ");newDateString=dateArray[0]+"T"+dateArray[1];logIt("newDateString="+newDateString);var b=new Date(newDateString);a=b.getTimezoneOffset()+360;logIt("typeof offset="+typeof a);d=new Date(b.getTime()-6E4*a);var b=d.getFullYear(),c="January February March April May June July August September October November December".split(" ")[d.getMonth()],e=d.getDate(),g=d.getHours(),f=d.getMinutes();logIt("offset="+a+", year="+b+", hours="+g);10>
f&&(f="0"+f);a="";a=12<g?g-12+":"+f+"pm":g+":"+f+"am";return e+" "+c+", "+b+" - "+a}function findPos(a){var b=0,c=0;if(a.offsetParent){do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{x:b,y:c}}}function rgbToHex(a,b,c){if(255<a||255<b||255<c)throw"Invalid color component";return(a<<16|b<<8|c).toString(16)}function logError(a,b,c){};