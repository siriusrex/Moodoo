var baseURL="https://www.moodoo.net/dev/test",logsOn=!1,theMoods="gloomy grouchy narky grumpy fuzzy happy boppy bouncy snappy zappy".split(" "),colourArray="#000000 #dd1f26 #df6b28 #f7971e #fed020 #f9ed32 #aad037 #3aa141 #007482 #1c75bc".split(" "),highlightArray="#333333 #e44c51 #e58953 #f9ac4b #fed94d #faf15b #bbd95f #61b467 #33909b #4491c9".split(" "),me={updates:null,firstName:"",lastName:"",email:"",ID:"",userID:"",moodNum:0,mood:"",status:"",lat:"",lng:"",currentAddress:"",publishToFacebook:"",
publishToMoodoo:"",publishToMap:"",reminder:"",code:""},token=null,updateMoodTimer,socialPublishFinished=!1,dataRefreshed=!1,pieContext,tools={open:!1};
function init(){logIt("init running");token=getParameterByName("token");logIt("token="+token);$(".section").each(function(){$(this).css("visibility","hidden");$(this).css("display","none");$(this).css("opacity",0);$(this).data("myHeight",$(this).css("height"));$(this).css("height",0);$(this).data("hidden",!0)});logIt("checking for cookie");validateNumeric($.cookie("moodooID"))?(logIt("cookie ID is numeric"),"null"!=$.cookie("moodooID")&&(hideDiv("auth"),$("#results").append("<p>Caught cookie. User id is "+
$.cookie("moodooID")),logIt("<p>Caught cookie. User id is "+$.cookie("moodooID")),logIt("sending cookie id to server"),loadUser($.cookie("moodooID"),null))):token?$.ajax({type:"POST",url:"janrain_auth.php",data:"token="+token,success:function(a,b,c){logIt("res="+a+", status="+b+", xhr="+c);for(var e in a)logIt("res["+e+"]="+a[e]);logIt("identifier: "+a.profile.identifier);logIt("displayName: "+a.profile.displayName);logIt("primaryKey: "+a.profile.primaryKey);a.profile.name&&logIt("givenName: "+a.profile.name.givenName);
logIt("sending social info to server");logIt("trying to close janrain window");janrain.engage.signin.modal.close();loadUser(null,a.profile)},error:function(a,b,c){logIt("error when sending token to janrain")}}):(logIt("cookie ID is invalid, reverting to janrain. janrainReady="+janrainReady),hideDiv("communication","auth"));$("#status").on("touchstart",function(a){$(this).focus()});$("#status").focus(function(){$("#status").animate({width:100},100,function(){})});$("#status").keypress(function(){logIt("#status just received keypress");
var a=12*$("#status").val().length;100>a&&(a=100);$("#status").animate({width:a},100,function(){})});$("#mooderatorGraph").mouseover(function(a){logIt("mouseover on mooderator event");onMouseOverGraph(a)});$("#mooderatorGraph").mouseout(function(a){logIt("mouseoout mooderator event");onMouseOutGraph(a)});$("#moodPieGraph").mouseover(function(a){logIt("mouseover on moodPie");onMouseOverPie(a)});$("#moodPieGraph").mouseout(function(a){logIt("mouseout on moodPie");onMouseOutPie(a)});$("#moodInput a").click(function(a){logIt("clicked mood button:"+
$(this).attr("mood"));setMood($(this).attr("mood"))});$("#moodInput a").click(function(a){logIt("clicked mood button:"+$(this).attr("mood"));setMood($(this).attr("mood"))});$("#moodInput a").on("touchstart",function(a){logIt("clicked mood button:"+$(this).attr("mood"));setMood($(this).attr("mood"))});$("#updateMoodButton").click(function(a){updateMood()});$("#cancelUpdateButton").click(function(a){cancelUpdateAtStatus()});$("#updateMoodButton").on("touchstart",function(a){updateMood()});$("#cancelUpdateButton").on("touchstart",
function(a){cancelUpdateAtStatus()});$("#toolButton").click(function(a){showTools()});$("#toolButton").on("touchstart",function(a){showTools()});$("#signOutButton").click(function(a){signUserOut()});$("#signOutButton").on("touchstart",function(a){signUserOut()});restyleJanrain();$(window).resize(function(a){onViewportResize()});logIt("init finished")}var janrainReady=!1,restyleInterval;
function restyleJanrain(){logIt("restyleJanrain running");$("#janrainEngageEmbed").css("visibility","hidden");$("#janrainEngageEmbed").css("margin-bottom","50px");$("#janrainEngageEmbed").css("min-height","400px");$("#janrainEngageEmbed").find("div").each(function(){$(this).attr("style","width: 100% !important;");$(this).css("text-align","center");$(this).css("font-family",'"Raleway", sans-serif;');$(this).css("font-size","1em");$(this).css("color","#fff");$(this).css("border","none");$(this).css("font-weight",
"400");$(this).css("display","block");$(this).css("clear","both");$(this).css("background-color","transparent")});$("#janrainEngageEmbed").find("ul").attr("style","display: inline-block; margin:0px; padding:0px; list-style-type:none; width:190px !important; float:left");$(".janrainPage").find("li").attr("style","");$(".janrainPage").find("li").each(function(){$(this).attr("style","width: 160px");$(this).css("height","30px");$(this).css("font-family",'"Raleway", sans-serif;');$(this).css("font-weight",
"400");$(this).css("background-color","transparent");$(this).css("background-image","none");$(this).css("padding","3px")});$("#janrainProviderPages").attr("style","width: 400px !important");$("#janrainEngageEmbed").find("a").attr("style",'margin: 20px; display: block; height: 30px; font-size: 1em; background-color: transparent !important; color: rgba(255, 255, 255, 0.2); background-image:none;  font-weight: 400; font-family: "Raleway", sans-serif;');$("#janrainEngageEmbed").find("a").hover(function(){$(this).attr("style",
'margin: 20px; display: block; height: 30px; font-size: 1em; background-color: transparent !important; color: rgba(255, 255, 255, 0.2); background-image:none;  font-weight: 400; font-family: "Raleway", sans-serif;');$(this).find("span").attr("style",'font-size: 1em; font-family: "Raleway", sans-serif; font-weight: 400; color: rgba(255, 255, 255, 0.2) !important; margin: 3px');$(this).find("span").find("span").attr("style",'font-size: 1em; font-family: "Raleway", sans-serif; font-weight: 400; color: rgba(255, 255, 255, 0.2) !important; margin: 3px')},
function(){$(this).attr("style",'margin: 20px; display: block; height: 30px; font-size: 1em; background-color: transparent !important; color: rgba(255, 255, 255, 0.2); background-image:none;  font-weight: 400; font-family: "Raleway", sans-serif;');$(this).find("span").attr("style",'font-size: 1em; font-family: "Raleway", sans-serif; font-weight: 400; color: rgba(255, 255, 255, 1) !important; margin: 3px');$(this).find("span").find("span").attr("style",'font-size: 1em; font-family: "Raleway", sans-serif; font-weight: 400; color: rgba(255, 255, 255, 1) !important; margin: 3px')});
$("#janrainEngageEmbed").find("a").click(function(){$("#janrainEngageEmbed").css("visibility","hidden")});$("#janrainEngageEmbed").find("li").attr("style",'background-color: transparent !important; color: rgba(255, 255, 255, 0.2); background-image:none; font-weight: 400; font-family: "Raleway", sans-serif;');$("#janrainEngageEmbed").find("li").hover(function(){$(this).attr("style",'background-color: transparent !important; color: rgba(255, 255, 255, 0.2); background-image:none;  font-weight: 400; font-family: "Raleway", sans-serif;');
$(this).find("span").attr("style",'font-family: "Raleway", sans-serif; font-weight: 400; color: rgba(255, 255, 255, 0.2) !important; margin: 3px')},function(){$(this).attr("style",'background-color: transparent !important; color: rgba(255, 255, 255, 0.2); background-image:none; font-weight: 400; font-family: "Raleway", sans-serif;');$(this).find("span").attr("style",'font-family: "Raleway", sans-serif; font-weight: 400; color: rgba(255, 255, 255, 1) !important; margin: 3px')});$("#janrainEngageEmbed").find("li").find("span").attr("style",
'font-family: "Raleway", sans-serif; font-weight: 400; color: #fff !important; margin: 3px');$(".janrainContent").css("height","250px");$(".janrainContent").css("margin","0px");$(".janrainHeader").css("width","300px");$(".janrainHeader").css("margin","0px auto 0px auto");$(".janrainHeader").css("text-align","center");$(".janrainHeader").css("padding-top","20px");$(".janrainHeader div").html("Sign in via your favourite social media service:");$("#janrainProviderPages").css("margin","20px auto 20px auto");
$("#janrainProviderPages").css("width","380px");$("#janrainProviderPages").css("height","400px");$(".janrainSwitchAccountLink").attr("style","display:none !important");janrainReady=!0;logIt("finished restyleJanrain code");$("#janrainEngageEmbed").css("visibility","visible")}
(function(){function a(){janrain.ready=!0}"object"!==typeof window.janrain&&(window.janrain={});"object"!==typeof window.janrain.settings&&(window.janrain.settings={});janrain.settings.tokenUrl=baseURL+"/janrain_redirect.php";janrain.settings.type="embed";janrain.settings.tokenAction="hybrid";janrain.settings.poup="false";document.addEventListener?document.addEventListener("DOMContentLoaded",a,!1):window.attachEvent("onload",a);var b=document.createElement("script");b.type="text/javascript";b.id=
"janrainAuthWidget";b.src="https:"===document.location.protocol?"https://rpxnow.com/js/lib/moodoo/engage.js":"http://widget-cdn.rpxnow.com/js/lib/moodoo/engage.js";var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)})();
function janrainWidgetOnload(){logIt("widget loaded");restyleJanrain();janrain.events.onProviderLoginStart.addHandler(function(a){logIt("Login Started")});janrain.events.onProviderLoginCancel.addHandler(function(a){logIt("Login Cancelled!");logIt("trying to close janrain window");janrain.engage.signin.modal.close();signUserOut()});janrain.events.onProviderLoginComplete.addHandler(function(a){logIt("Login complete - either successful or unsuccessful");logIt("trying to close janrain window");janrain.engage.signin.modal.close()});
janrain.events.onProviderLoginToken.addHandler(function(a){clearInterval(restyleInterval);logIt("got response: "+a.token);$.ajax({type:"POST",url:"janrain_auth.php",data:"token="+a.token,success:function(a,c,e){logIt("res="+a+", status="+c+", xhr="+e);for(var f in a)logIt("res["+f+"]="+a[f]);logIt("identifier: "+a.profile.identifier);logIt("displayName: "+a.profile.displayName);logIt("primaryKey: "+a.profile.primaryKey);a.profile.name&&logIt("givenName: "+a.profile.name.givenName);logIt("sending social info to server");
logIt("trying to close janrain window");janrain.engage.signin.modal.close();loadUser(null,a.profile)},error:function(a,c,e){logIt("error when sending token to janrain")}})})}
function loadUser(a,b){logIt("loadUser running; userID="+a+", socialProfile="+b);$("#communication").html("<h1>Loading your data...</h1>");showDiv("communication");a?(logIt("sending userID from cookie to server, userID="+a),$.ajax({type:"POST",url:"moodoo_auth_main.php",data:{userID:a},success:function(a,b,f){logIt("cookie data send success! server says: res="+a+", status="+b+", xhr="+f);logIt("php log:"+a.log);logIt("submitted query:"+a.query);logIt("create user query:"+a.createQuery);logIt("new user ID:"+
a.newuserID);logIt("query success:"+a.success);logIt("social ID:"+a.socialID);logIt("user ID:"+a.userID);logIt("firstName:"+a.firstName);logIt("lastName:"+a.lastName);logIt("email:"+a.email);logIt("publishSocial:"+a.publishSocial);logIt("publishToMoodoo:"+a.publishToMoodoo);logIt("allowLocation:"+a.allowLocation);logIt("reminder:"+a.reminder);logIt("updates:"+a.updates);me.ID=a.userID;me.socialID=a.socialID;me.firstName=a.firstName;me.lastName=a.lastName;me.email=a.email;me.publishSocial=a.publishSocial;
me.publishToMoodoo=me.publishToMoodoo;me.allowLocation=a.allowLocation;me.reminder=a.reminder;me.updates=a.updates;for(var g in a.updates);onDataRefreshed()},error:function(a,b,f){logIt("ERROR! while trying to send cookie ID to server. data="+a+", status="+b+", xhr="+f);for(var g in a)logIt(g+"="+a[g])}})):b?(logIt("sending socialProfile from janrain to moodoo server, socialProfile.identifier="+b.identifier),b.name&&(me.firstName=b.name.givenName,me.lastName=b.name.familyName),$.ajax({type:"POST",
url:"moodoo_auth_main.php",data:{userID:a,firstName:me.firstName,lastName:me.lastName,socialID:b.identifier,email:b.email},success:function(a,b,f){logIt("socialProfile send success! server says: res="+a+", status="+b+", xhr="+f);for(var g in a)logIt("looking at data; res["+g+"]="+a[g]);logIt("submitted query:"+a.query);logIt("query success:"+a.success);logIt("new user ID:"+a.newuserID);logIt("user ID:"+a.userID);logIt("social ID:"+a.socialID);logIt("name:"+a.name);logIt("firstName:"+a.firstName);
a.givenName&&logIt("givenName:"+a.givenName);logIt("lastName:"+a.lastName);logIt("email:"+a.email);logIt("publishSocial:"+a.publishSocial);logIt("publishToMoodoo:"+a.publishToMoodoo);logIt("allowLocation:"+a.allowLocation);logIt("reminder:"+a.reminder);logIt("php log:"+a.log);logIt("updates:"+a.updates);me.ID=a.userID;me.socialID=a.socialID;me.firstName=a.firstName;me.lastName=a.lastName;me.email=a.email;me.publishSocial=a.publishSocial;me.publishToMoodoo=me.publishToMoodoo;me.allowLocation=a.allowLocation;
me.reminder=a.reminder;me.updates=a.updates;for(var h in a.updates);$.cookie("moodooID",a.userID);logIt("trying to access cookie:"+$.cookie("moodooID"));onDataRefreshed()},error:function(a,b,f){logIt("ERROR! while trying to send social ID to server. data="+a+", status="+b+", xhr="+f);for(var g in a)logIt(g+"="+a[g])}})):logIt("ERROR: neither cookie id nor socialProfile passed to loadUser function")}
function onDataRefreshed(){dataRefreshed=!0;$("#tools").css("display","inline-block");showDiv("moodInput");createDisplay()}function showTools(){logIt("showTools running");$("#signOutButton").animate({opacity:1,width:"130px",padding:"15px 10px"},100,function(){tools.open=!0})}function hideTools(){logIt("hideTools running");$("#signOutButton").animate({opacity:0,width:"0px",padding:"0px"},100,function(){tools.open=!1})}
function signUserOut(){$("#tools").css("display","none");$.cookie("moodooID",null);token=null;window.open(baseURL,"_self")}function setMood(a){logIt("setMood running");logIt("theMoods[mood]="+theMoods[a]);me.moodNum=a;getLocation();$("#statusLabel").html("Why are you feeling "+theMoods[a]+"?");hideDiv("moodInput","statusBox")}
function updateMood(){logIt("updateMood running");$("#communication").html("<h1>Updating your mood...</h1>");hideDiv("statusBox","communication");dataRefreshed=socialPublishFinished=!1;checkUpdateStatus();me.status=escape($("#status").val());logIt("about to update status, me.status="+me.status);logIt("updating mood, me.publishSocial="+me.publishSocial);$.ajax({type:"POST",url:"updateMood.php",data:{socialID:me.socialID,userID:me.ID,mood:me.moodNum,lat:me.lat,lng:me.lng,status:me.status,code:me.code},
success:function(a,b,c){logIt("updateMood data sent successfully");updateMoodResponse(a)},error:function(a,b,c){logIt("ERROR! updateMood failed");$("#communication").html("<h1>Oops! Something went wrong.</h1><p>We couldn't talk to the Moodoo server. <br/>Please check your connection and try again in a few minutes.<br/> Your mood has not been updated.</p>");showDiv("communication");logIt("data="+a+", status="+b+", xhr="+c);for(var e in a)logIt(e+"="+a[e])}});1==me.publishSocial?publishToSocial():socialPublishFinished=
!0;$("#status").val("")}function updateMoodResponse(a){logIt("updateMoodResponse running");logIt("res="+a);if(a){for(var b in a)logIt("res["+b+"]="+a[b]);1==a.moodUpdated?(logIt("Mood updated, refreshing data. me.ID="+me.ID),dataRefreshed=!1,loadUser(me.ID,null)):logIt("ERROR: Something wrong with the MySQL query, mood not updated in database!")}else logIt("ERROR: no data returned from updateMood script!")}var checkUpdateStatusTick=0;
function checkUpdateStatus(){logIt("checkUpdateStatus running");checkUpdateStatusTick++;updateMoodTimer=setTimeout("checkUpdateStatus()",100);socialPublishFinished&&dataRefreshed?(logIt("all processes complete"),clearTimeout(updateMoodTimer)):50<checkUpdateStatusTick?clearTimeout(updateMoodTimer):logIt("chaeckUpdateStatus tick:"+checkUpdateStatusTick+", socialPublishFinished="+socialPublishFinished+", dataRefreshed="+dataRefreshed)}
function cancelUpdateAtStatus(){$("#status").val("");hideDiv("statusBox","moodInput")}var canvas,ctx,ctxMini,mooderatorHeight=300,viewportWidth=$(window).width()-110,mooderatorWidth=viewportWidth,backgroundColour1="#47709E",backgroundColour2="#FFFFFF",backgroundColour3="#3A5D7C",backgroundColour4="#FFFFFF",backgroundColour5="#FFFFFF",backgroundColour6="#47709E",startTime,timeSpan,borderColour="#666666",dragging,dragOffset,rightMargin;$("#mooderatorGraph").addClass("grab");
var windowSpan,pixelWidth,baseX=0,miniBaseX=0,baseXRatio=0,canvasPoints,sliderWidthRatio=.9,sliderPosRatio=0,mooderatorZoomRatio=1;
function drawMooderator(){viewportWidth=$(window).width()-110;logIt("drawMooderator running");var a=me.updates;$("#mooderatorGraph").attr("width",$(window).width()-100);$("#mooderatorGraph").attr("height",mooderatorHeight);$("#mooderatorGraph").css("display","block");$("#mooderatorGraph").css("width",$(window).width()-100+"px");$("#mooderatorGraph").css("margin","0px auto 0px auto");var b=a[0].seconds;timespan=a[a.length-1].seconds-b;startTime=b;(canvas=document.getElementById("mooderatorGraph"))?
canvas.getContext?(ctx=canvas.getContext("2d"),drawGraph(a)):logIt("drawmooderator - ERROR - no getContext method on canvas element"):logIt("drawmooderator - ERROR -canvas isnt registered!")}
function drawGraph(a){logIt("drawGraph running");for(var b=[],c=0;c<a.length;c++)b[c]=(a[c].seconds-startTime)/timespan;ctx.clearRect(0,0,450,150);c=mooderatorHeight-30;ctx.lineWidth=.5;ctx.lineCap="round";ctx.lineJoin="round";var e=c/10;ctx.moveTo(baseX,c-a[0].mood*e);ctx.beginPath();canvasPoints=[];for(var f=0;f<a.length;f++){var g=b[f]*mooderatorWidth+baseX+5,h=10+c-a[f].mood*e;0>b[f+1]*mooderatorWidth+baseX+5||(ctx.lineTo(g,h),canvasPoints.push({x:g,y:h,number:f,mood:a[f].mood}))}ctx.strokeStyle=
"rgba(255, 255, 255, 1)";ctx.stroke();for(a=ctx.lineWidth=0;a<canvasPoints.length;a++)b=parseInt(canvasPoints[a].mood),parseInt(canvasPoints[a].mood),ctx.fillStyle=colourArray[b],ctx.strokeStyle="rgba(255, 255, 255, 0)",ctx.lineWidth=0,drawSolidCircle(ctx,canvasPoints[a].x,canvasPoints[a].y,4);showDiv("mooderator")}
function drawMooderatorControl(){logIt("drawMooderatorControl running");$("#miniGraph").attr("width",viewportWidth);$("#miniGraph").attr("height",80);$("#miniGraph").width(viewportWidth);$("#miniGraphSlider").width()>viewportWidth&&$("#miniGraphSlider").width(viewportWidth);$("#miniGraphSlider").css("margin-left","auto");$("#miniGraphSlider").css("margin-right","auto");$("#miniGraph").css("display","block");$("#miniGraph").css("margin","0px auto 100px auto");(canvasMini=document.getElementById("miniGraph"))?
canvasMini.getContext?(ctxMini=canvasMini.getContext("2d"),drawMiniGraph(me.updates)):logIt("drawmooderator - ERROR - no getContext method on canvasMini element"):logIt("drawmooderator - ERROR -canvasMini isnt registered!")}
function drawMiniGraph(a){logIt("drawMiniGraph running");for(var b=[],c=0;c<a.length;c++)b[c]=(a[c].seconds-startTime)/timespan;ctxMini.clearRect(0,0,450,150);ctxMini.lineWidth=.5;ctxMini.lineCap="round";ctxMini.lineJoin="round";ctxMini.moveTo(miniBaseX,50-5*a[0].mood);ctxMini.beginPath();canvasMiniPoints=[];for(c=0;c<a.length;c++){var e=b[c]*viewportWidth+miniBaseX+5,f=60-5*a[c].mood;0>b[c+1]*viewportWidth+miniBaseX+5||(ctxMini.lineTo(e,f),canvasMiniPoints.push({x:e,y:f,number:c,mood:a[c].mood}))}ctxMini.strokeStyle=
"rgba(255, 255, 255, 1)";ctxMini.stroke()}
function setMiniGraphSlider(){logIt("setMiniGraphSlider running");$("#miniGraphSlider").css("margin","0px 0px");$("#miniGraphSlider").offset({top:$("#miniGraphSlider").offset().top,left:55});$("#sliderHandleRight").mousedown(function(a){onMouseDownSliderRight(a)});$("#sliderHandleLeft").mousedown(function(a){logIt("mousedown on slider left handle");onMouseDownSliderLeft(a)});$("#miniGraphSlider").mousedown(function(a){logIt("mousedown on slider body");onMouseDownSliderBody(a)});$(document).mouseup(function(a){onMouseUpDocument(a)});
$("#sliderHandleRight").on("touchstart",function(a){logIt("touch on slider right handle");onTouchStartSliderRight(a)});$("#sliderHandleLeft").on("touchstart",function(a){logIt("touch on slider left handle");onTouchStartSliderLeft(a)});$("#miniGraphSlider").on("touchstart",function(a){onTouchStartSliderBody(a)});$(document).on("touchstart",function(a){removeSliderMouseEvents()});$(document).on("touchend",function(a){onTouchEndSlider(a)});$(document).on("touchcancel",function(a){onTouchEndSlider(a)})}
function removeSliderMouseEvents(){$("#miniGraphSlider").off("mousedown");$("#miniGraphSlider").off("mousemove");$("#sliderHandleRight").off("mousedown");$("#sliderHandleLeft").off("mousedown")}
function zoomIn(){logIt("zoomIn running, mooderatorWidth="+mooderatorWidth);var a=mooderatorWidth,b=Math.abs(baseX)+($("#mooderatorGraph").width()-10)/2;mooderatorWidth*=1.25;var c=b/a*mooderatorWidth,e=0;logIt("baseX="+baseX);e=c-b;logIt("baseX="+baseX);logIt("oldMooderatorWidth="+a);logIt("mooderatorWidth="+mooderatorWidth);logIt("oldCentre="+b);logIt("newCentre="+c);logIt("scrollAmount="+e);scrollRight(e)}
function zoomOut(){logIt("zoomOut running, mooderatorWidth="+mooderatorWidth);var a=mooderatorWidth,b=Math.abs(baseX)+($("#mooderatorGraph").width()-10)/2;mooderatorWidth*=.8;mooderatorWidth<$("#mooderatorGraph").width()-10&&(mooderatorWidth=$("#mooderatorGraph").width()-10);scrollLeft(b-b/a*mooderatorWidth)}
function zoomTo(a,b){Math.abs(baseX);$("#mooderatorGraph").width();mooderatorWidth=viewportWidth*viewportWidth/a;var c=0,c=mooderatorWidth/viewportWidth*b;baseX=-c;baseXRatio=c/$(window).width();drawMooderator()}function scrollLeft(a){a||(a=10);baseX+=a;0<=baseX&&(baseX=0);drawMooderator()}function scrollRight(a){a||(a=10);baseX-=a;drawMooderator()}
function createMoodPie(a){logIt("createMoodPie running");noOfUpdates=me.updates.length;logIt("noOfUpdates="+noOfUpdates);for(var b=[0,0,0,0,0,0,0,0,0,0],c=[],e=0;e<me.updates.length;e++){var f=parseInt(me.updates[e].mood);b[f]+=1}logIt("moodFrequency="+b);for(var g in b)0<b[g]&&(e=parseInt(b[g])/noOfUpdates,c.push(Object({number:e,colour:colourArray[g]})));logIt("pieSlicePercentages="+c);b=viewportWidth/2;$("#moodPie").data("myHeight",b+300);$("#moodPieGraph").attr("width",b);$("#moodPieGraph").attr("height",
b);$("#moodPieGraph").css("margin-left","auto");$("#moodPieGraph").css("margin-right","auto");logIt("pieWidth="+b);drawPie(c,b/2,a);$("#moodPieLabel").css("top",-(b/2)-75+"px");$("#moodPieLabel").css("left",$("#moodPieGraph").offset().left+b/2-75+"px");logIt("highlight="+a);void 0!=a?($("#moodPieLabel #moodIcon").css("background-image","url(images/"+theMoods[a]+"_roll.png)"),$("#moodPieLabel #moodTextLabel").html(theMoods[a]+"<br/>"),a=Math.floor(100*c[a].number),$("#moodPieLabel #percentage").html('<span style="font-size:3em">'+
a+"%</span><br/> of updates")):($("#moodPieLabel #moodIcon").css("background-image","none"),$("#moodPieLabel #moodTextLabel").html(""),$("#moodPieLabel #percentage").html(""))}
function drawPie(a,b,c){logIt("drawPie running");var e=document.getElementById("moodPieGraph");e.imageSmoothingEnabled=!0;e.getContext&&(pieContext=e.getContext("2d"));pieContext.lineWidth=1;pieContext.lineCap="round";pieContext.lineJoin="round";pieContext.save();pieContext.beginPath();pieContext.arc(b,b,300,0,2*Math.PI,!0);pieContext.arc(b,b,100,0,2*Math.PI,!1);pieContext.closePath();pieContext.clip();for(var f=e=0;f<a.length;f++){pieContext.beginPath();pieContext.moveTo(b,b);var g=pieContext.createLinearGradient(0,
0,0,300);g.addColorStop(0,a[f].colour);g.addColorStop(1,"#000000");pieContext.fillStyle=a[f].colour;g=2*Math.PI*a[f].number;pieContext.arc(b,b,b,e-.01,e+g+.01,!1);pieContext.closePath();pieContext.fill();void 0!=c&&f==c&&(pieContext.fillStyle="rgba(255,255, 255, 0.2)",pieContext.arc(b,b,b,e-.01,e+g+.01,!1),pieContext.closePath(),pieContext.fill());e+=g}showDiv("moodPie")}
function createDisplay(a){logIt("createDisplay running; me.updates="+me.updates);me.updates?1<me.updates.length?($("#communication").html("<h1>Hey, "+me.firstName+", how are you feeling right now?</h1>"),showDiv("communication"),drawMooderator(),drawMooderatorControl(),createMoodPie(null)):($("#communication").html("<h1>Less than 2 Mood Updates</h1><p>Hey, "+me.firstName+", it looks like you've updated your mood less than twice so far. To really see what Moodoo can do, let us know how you're feeling now!</p>"),
showDiv("communication")):($("#communication").html("<h1>No Mood Updates</h1><p>Hey, "+me.firstName+", it looks like you haven't done any mood updates yet. To get started with Moodoo, let us know how you're feeling now!</p>"),showDiv("communication"));setMiniGraphSlider();showDiv("moodInput");showDiv("tools");hideDiv("auth")}
function onViewportResize(){logIt("onViewportResize running");var a=$(window).width()-110,b=$(window).width()*sliderWidthRatio,c=a*sliderPosRatio,e=a*mooderatorZoomRatio,f=a*baseXRatio;logIt("newSliderWidth="+b+", newSliderPos="+c+", mooderatorZoomRatio="+mooderatorZoomRatio);$("#miniGraphSlider").css("width",b+"px");$("#miniGraphSlider").offset({top:$("#miniGraphSlider").offset().top,left:c});$("#moodPieLabel").css("top",-(pieWidth/2)-75+"px");$("#moodPieLabel").css("left",$("#moodPieGraph").offset().left+
pieWidth/2-75+"px");mooderatorWidth=e;viewportWidth=a;baseX=-f;me.updates&&1<me.updates.length&&(drawMooderator(),drawMooderatorControl())}function onMouseOverGraph(a){logIt("mouseover on graph");$("#mooderatorGraph").mousemove(function(a){onMouseMoveGraph(a)})}function onMouseOutGraph(a){logIt("onMouseOutGraph running");$("#mooderatorGraph").off("mousemove",$("#mooderatorGraph"),onMouseMoveGraph)}
function onMouseMoveGraph(a){logIt("onMouseMoveGraph");var b=$("#mooderatorGraph").offset(),c=a.pageX-b.left;a=a.pageY-b.top;for(var b=!1,e=0;e<canvasPoints.length;e++){var f=Math.round(canvasPoints[e].x),g=Math.round(canvasPoints[e].y);f>c-20&&f<c+20&&g>a-20&&g<a+20&&(logIt("hit"),b=!0,showToolTip(canvasPoints[e].x,canvasPoints[e].y,canvasPoints[e].number));1!=b&&hideToolTip()}}
function onMouseDownSliderLeft(a){logIt("mousedown on slider left handle");a.preventDefault?a.preventDefault():a.returnValue=!1;a.stopPropagation&&a.stopPropagation();rightMargin=$(window).width()-$("#miniGraphSlider").offset().left-$("#miniGraphSlider").width()-50;$(document).mousemove(function(a){onMouseMoveSlider(a,"left")})}
function onMouseDownSliderRight(a){logIt("mousedown on slider right handle");a.preventDefault?a.preventDefault():a.returnValue=!1;a.stopPropagation&&a.stopPropagation();rightMargin=$(window).width()-$("#miniGraphSlider").offset().left-$("#miniGraphSlider").width()-50;$(document).mousemove(function(a){onMouseMoveSlider(a,"right")});$(document).on("touchMove",function(a){onTouchMoveSlider(a,"right")})}
function onMouseDownSliderBody(a){logIt("mousedown on slider body");a.preventDefault?a.preventDefault():a.returnValue=!1;a=a.originalEvent.touches?a.originalEvent.touches[0].pageX-$("#miniGraph").offset().left:a.pageX-$("#miniGraph").offset().left;$("#miniGraphSlider").css("cursor"," -webkit-grabbing");dragOffset=a-$("#miniGraphSlider").offset().left;$(document).mousemove(function(a){onMouseMoveSlider(a,null)});$(document).on("touchMove",function(a){onTouchMoveSlider(a,null)})}
function onMouseMoveSlider(a,b){a.preventDefault?a.preventDefault():a.returnValue=!1;var c;c=a.originalEvent.touches?a.originalEvent.touches[0].pageX-$("#miniGraph").offset().left:a.pageX-$("#miniGraph").offset().left;logIt("onMouseMoveSlider, e.pageX="+a.pageX+", e.pageY="+a.pageY);if("left"==b)-5<c&&($("#miniGraphSlider").css("margin","0px"),$("#miniGraphSlider").offset({top:$("#miniGraphSlider").offset().top,left:c+$("#miniGraph").offset().left}),logIt("mousemove left handle, rightMargin="+rightMargin),
$("#miniGraphSlider").css("width",$("#miniGraph").width()-c-rightMargin+"px"));else if("right"==b){if(logIt("mousemove; over halfway"),c<$("#miniGraph").width()+10){var e=parseInt($("#miniGraphSlider").offset().left),f=$("#miniGraph").width()-c,g=c-e+$("#miniGraph").offset().left;logIt("minigraph width="+$("#miniGraph").width()+", originalMargin="+e+", endOffset="+f+", newWidth="+g);$("#miniGraphSlider").css("width",g+"px");$("#miniGraphSlider").offset({top:$("#miniGraphSlider").offset().top,left:e})}}else logIt("dragging whole bar; xpos="+
c+" ,dragOffset="+dragOffset),e=c-dragOffset+$("#miniGraph").offset().left,logIt("newMargin="+e),f=$("#miniGraph").offset().left-5,g=$("#miniGraph").width()+$("#miniGraph").offset().left+10,e>f&&$("#miniGraphSlider").width()+e<g&&$("#miniGraphSlider").offset({top:$("#miniGraphSlider").offset().top,left:e});logIt("mousemove on slider, xpos="+c)}
function onTouchStartSliderLeft(a){logIt("touchstart on slider left handle");a.preventDefault?a.preventDefault():a.returnValue=!1;a.stopPropagation&&a.stopPropagation();rightMargin=$(window).width()-$("#miniGraphSlider").offset().left-$("#miniGraphSlider").width()-50;$("#miniGraphSlider").on("touchmove",function(a){onTouchMoveSlider(a,"left")})}
function onTouchStartSliderRight(a){logIt("touchstart on slider right handle");a.preventDefault?a.preventDefault():a.returnValue=!1;a.stopPropagation&&a.stopPropagation();rightMargin=$(window).width()-$("#miniGraphSlider").offset().left-$("#miniGraphSlider").width()-50;$("#miniGraphSlider").on("touchmove",function(a){onTouchMoveSlider(a,"right")})}
function onTouchStartSliderBody(a){logIt("touchstart on slider body");dragOffset=(a.originalEvent.touches?a.originalEvent.touches[0].pageX-$("#miniGraph").offset().left:a.pageX-$("#miniGraph").offset().left)-$("#miniGraphSlider").offset().left;$("#miniGraphSlider").on("touchmove",function(a){logIt("touchMove event");onTouchMoveSlider(a,null)})}
function onTouchMoveSlider(a,b){logIt("onTouchMoveSlider running, leftOrRight="+b);a.preventDefault?a.preventDefault():a.returnValue=!1;var c;c=a.originalEvent.touches?a.originalEvent.touches[0].pageX-$("#miniGraph").offset().left:a.pageX-$("#miniGraph").offset().left;logIt("onTouchMoveSlider, e.originalEvent.touches[0].pageX="+a.originalEvent.touches[0].pageX);if("left"==b)logIt("dragging left handle; xpos="+c+" ,dragOffset="+dragOffset),-5<c&&($("#miniGraphSlider").css("margin","0px"),$("#miniGraphSlider").offset({top:$("#miniGraphSlider").offset().top,
left:c+$("#miniGraph").offset().left}),logIt("mousemove left handle, rightMargin="+rightMargin),$("#miniGraphSlider").css("width",$("#miniGraph").width()-c-rightMargin+"px"));else if("right"==b){if(logIt("dragging right handle; xpos="+c+" ,dragOffset="+dragOffset),c<$("#miniGraph").width()+10){var e=parseInt($("#miniGraphSlider").offset().left),f=$("#miniGraph").width()-c,g=c-e+$("#miniGraph").offset().left;logIt("minigraph width="+$("#miniGraph").width()+", originalMargin="+e+", endOffset="+f+", newWidth="+
g);$("#miniGraphSlider").css("width",g+"px");$("#miniGraphSlider").offset({top:$("#miniGraphSlider").offset().top,left:e})}}else logIt("dragging whole bar; xpos="+c+" ,dragOffset="+dragOffset),e=c-dragOffset+$("#miniGraph").offset().left,logIt("newMargin="+e),f=$("#miniGraph").offset().left-5,g=$("#miniGraph").width()+$("#miniGraph").offset().left+10,e>f&&$("#miniGraphSlider").width()+e<g&&$("#miniGraphSlider").offset({top:$("#miniGraphSlider").offset().top,left:e});logIt("touchmove on slider, xpos="+
c)}
function onTouchEndSlider(a){logIt("onTouchEndSlider running");$(document).off("mousemove");$(document).off("touchmove");$("#miniGraphSlider").off("mousemove");$("#miniGraphSlider").off("touchmove");a.preventDefault?a.preventDefault():a.returnValue=!1;sliderWidthRatio=$("#miniGraphSlider").width()/$(window).width();sliderPosRatio=$("#miniGraphSlider").offset().left/($(window).width()-110);mooderatorZoomRatio=mooderatorWidth/($(window).width()-110);logIt("at touchend, sliderWidthRatio="+sliderWidthRatio+", miniGraphSlider.offset().left="+
$("#miniGraphSlider").offset().left+", sliderPosRatio="+sliderPosRatio);zoomTo($("#miniGraphSlider").innerWidth(),$("#miniGraphSlider").offset().left-$("#miniGraph").offset().left)}function onMouseOverPie(a){logIt("onMouseOverPie running");$("#moodPieGraph").mousemove(function(a){onMouseMovePie(a)})}
function onMouseOutPie(a){logIt("onMouseOutPie running");$("#moodPieGraph").off("mousemove",$("#moodPieGraph"),onMouseMovePie);$("#moodPieLabel #moodIcon").css("background-image","none");$("#moodPieLabel #moodTextLabel").html("");$("#moodPieLabel #percentage").html("")}
function onMouseMovePie(a){logIt("onMouseMovePie running");var b=$("#moodPieGraph").offset(),c=a.pageX-b.left;a=a.pageY-b.top;logIt("x:"+c+", y:"+a);c=pieContext.getImageData(c,a,1,1).data;c="#"+("000000"+rgbToHex(c[0],c[1],c[2])).slice(-6);logIt("hex="+c);logIt("colourArray.indexOf(hex)="+colourArray.indexOf(c));logIt("rolled over "+theMoods[colourArray.indexOf(c)]);-1==highlightArray.indexOf(c)&&-1!=colourArray.indexOf(c)&&createMoodPie(colourArray.indexOf(c))}
function onMouseUpDocument(a){logIt("mouseup");a.preventDefault?a.preventDefault():a.returnValue=!1;$(document).off("mousemove");$(document).off("touchmove");$("#miniGraphSlider").off("mousemove");$("#miniGraphSlider").off("touchmove");$("#miniGraphSlider").css("cursor"," -webkit-grab");sliderWidthRatio=$("#miniGraphSlider").width()/$(window).width();sliderPosRatio=$("#miniGraphSlider").offset().left/($(window).width()-110);mooderatorZoomRatio=mooderatorWidth/($(window).width()-110);logIt("at mouseup, sliderWidthRatio="+
sliderWidthRatio+", miniGraphSlider.offset().left="+$("#miniGraphSlider").offset().left+", sliderPosRatio="+sliderPosRatio);zoomTo($("#miniGraphSlider").innerWidth(),$("#miniGraphSlider").offset().left-$("#miniGraph").offset().left);tools.open&&(logIt("tools open, closing tools"),hideTools(),tools.open=!1)}
function showToolTip(a,b,c){logIt("showToolTip running; $('#mooderatorGraph').offset().left="+$("#mooderatorGraph").offset().left+"; posX="+a+"; posY="+b);$("#mooderatorPopUpLabel").css("visibility","visible");c=parseInt(c);logIt("arrayIndex="+c);logIt("me.updates[arrayIndex].status="+me.updates[c].status);var e=me.updates[c].mood,f=convertDate(me.updates[c].time);$("#mooderatorPopUpLabel").html("<span style='font-size: 0.7em; color: #fff; margin:0px; padding:0px'>"+f+"</span> <br/> <span id='labelRoundBox' style='background-color:"+
colourArray[me.updates[c].mood]+"'>"+theMoods[me.updates[c].mood]+"</span> "+unescape(me.updates[c].status));$("#mooderatorPopUpLabel").css("height",b+"px");$("#mooderatorPopUpLabel").css("top",$("#mooderatorGraph").offset().top+b-$("#mooderatorPopUpLabel").height()-10+"px");a>$(window).width()/2?(logIt("popUpLabel overlaps window"),$("#mooderatorPopUpLabel").css("border-left","0px"),$("#mooderatorPopUpLabel").css("border-right","1px #fff solid"),$("#mooderatorPopUpLabel").css("text-align","right"),
$("#mooderatorPopUpLabel").css("margin-left",$("#mooderatorGraph").offset().left+a-$("#mooderatorPopUpLabel").width()-18+"px")):($("#mooderatorPopUpLabel").css("border-right","0px"),$("#mooderatorPopUpLabel").css("border-left","1px #fff solid"),$("#mooderatorPopUpLabel").css("text-align","left"),$("#mooderatorPopUpLabel").css("margin-left",$("#mooderatorGraph").offset().left+a-1+"px"));3<e&&6>e&&$("#labelRoundBox").css("color","#000");$("#mooderatorPopUpLabel").css("visibility","visible")}
function hideToolTip(){$("#mooderatorPopUpLabel").css("visibility","hidden")}var gl,geocoder,geocoder2,locationTimer,timeSinceLocationQuery=0;function locationTimeoutCheck(){logIt("locationTimeoutCheck tick");timeSinceLocationQuery+=100;1E4<timeSinceLocationQuery?stopLocationTimer():locationTimer=setTimeout("locationTimeoutCheck()",100)}function stopLocationTimer(){logIt("stopLocationTimer running");clearTimeout(locationTimer);timeSinceLocationQuery=0}
function getLocation(){logIt("getLocation running");locationTimeoutCheck();Modernizr.geolocation?(logIt("Modernizr.geolocation=true"),gl=navigator.geolocation,gl.getCurrentPosition(recordPosition,function(a){logIt("geolocation error! error="+a);stopLocationTimer()},{maximumAge:Infinity,timeout:6E3})):(logIt("cant get geolocation"),stopLocationTimer())}function manualLocate(){logIt("manualLocate running");showDiv("manualLocation")}
function findMe(){logIt("findMe running");var a=$("#address").value;logIt("theAddress="+a);encodeAddress(a)}
function encodeAddress(a){logIt("encodeAddress running");$("#communication").html("Attempting to get your location from your address, please wait...<br/>");geocoder=new google.maps.Geocoder;geocoder.geocode({address:a},function(a,c){if(c==google.maps.GeocoderStatus.OK){var e=a[0].geometry.location;logIt("geocoding successful; lat="+e.lat()+", lng="+e.lng());me.lat=e.lat();me.lng=e.lng();e=new google.maps.LatLng(me.lat,me.lng);logIt("calling getAddress from encodeAddress");getAddress(e)}else logIt("Geocode was not successful for the following reason: "+
c);stopLocationTimer()})}function cancelUpdateAtGeocode(){$("#locationBox").css("display","none")}function updateWithoutLocation(){$("#changeLocationButton").css("display","none")}function recordPosition(a){logIt("recordPosition running");me.lat=a.coords.latitude;me.lng=a.coords.longitude;a=new google.maps.LatLng(me.lat,me.lng);stopLocationTimer();logIt("calling getAddress from recordPosition");getAddress(a)}
function getAddress(a){logIt("getAddress running; latlng="+a);var b=" ";geocoder2=new google.maps.Geocoder;a&&geocoder2.geocode({latLng:a},function(a,e){e==google.maps.GeocoderStatus.OK?(a[0]?(b=a[2].formatted_address,logIt("returnedAddress="+b)):logIt("reverse geocode: No results found"),$("#changeLocationButton").css("display","block")):logIt("Geocoder failed due to: "+e)})}
function publishToSocial(){logIt("publishToSocial running");logIt("me.moodNum="+me.moodNum);logIt("me.mood="+me.mood);socialPublishFinished=!0}function logIt(a){logsOn&&console.log(a)}function validateNumeric(a){var b=!0,c=/^[0-9 +]+$/;a?a.match(c)||(b=!1):b=!1;return b}
function showDiv(a){$("#"+a).data("hidden")&&($("#"+a).data("hidden",!1),logIt("showing div "+a),$("#"+a).css("display","block"),logIt("$(#"+a+').css("display")='+$("#"+a).css("display")),logIt("$(#"+a+').data("myHeight")='+$("#"+a).data("myHeight")),$("#"+a).animate({height:$("#"+a).data("myHeight")},500,function(){$("#"+a).css("visibility","visible");"0px"==$("#"+a).css("height")&&$("#"+a).css("height","auto");$("#"+a).animate({top:"0px",opacity:1},500,function(){logIt("$(#"+a+').css("display")='+
$("#"+a).css("display"))})}))}var divToShow;
function hideDiv(a,b){divToShow=b?b:null;0==$("#"+a).data("hidden")?($("#"+a).data("hidden",!0),logIt("hiding div "+a+", swapper="+b),0<$("#"+a).outerHeight()&&$("#"+a).data("myHeight",$("#"+a).height()),logIt("$(#"+a+').data("myHeight")='+$("#"+a).data("myHeight")),$("#"+a).animate({top:"-150",opacity:0},500,function(){logIt("hideDiv animation finished. swapper= "+divToShow);$("#"+a).css("visibility","hidden");$("#"+a).animate({height:"0"},500,function(){$("#"+a).css("display","none");divToShow&&
showDiv(divToShow)})})):showDiv(divToShow)}function roundRect(a,b,c,e,f,g,h,k){"undefined"==typeof k&&(k=!0);"undefined"===typeof g&&(g=5);a.beginPath();a.moveTo(b+g,c);a.lineTo(b+e-g,c);a.quadraticCurveTo(b+e,c,b+e,c+g);a.lineTo(b+e,c+f-g);a.quadraticCurveTo(b+e,c+f,b+e-g,c+f);a.lineTo(b+g,c+f);a.quadraticCurveTo(b,c+f,b,c+f-g);a.lineTo(b,c+g);a.quadraticCurveTo(b,c,b+g,c);a.closePath();k&&a.stroke();h&&a.fill()}
function drawSolidCircle(a,b,c,e){a.beginPath();a.arc(b,c,e,0,2*Math.PI,!1);a.closePath();a.stroke();a.fill()}function getParameterByName(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=(new RegExp("[\\?&]"+a+"=([^&#]*)")).exec(location.search);return null==a?"":decodeURIComponent(a[1].replace(/\+/g," "))}
function convertDate(a){logIt("dateString="+a);dateArray=a.split(" ");newDateString=dateArray[0]+"T"+dateArray[1];logIt("newDateString="+newDateString);a=new Date(newDateString);logIt("typeof offset=number");d=new Date(a.getTime()-396E5);a=d.getFullYear();var b="January February March April May June July August September October November December".split(" ")[d.getMonth()],c=d.getDate(),e=d.getHours(),f=d.getMinutes();logIt("offset=660, year="+a+", hours="+e);10>f&&(f="0"+f);var g="",g=12<e?e-12+":"+
f+"pm":e+":"+f+"am";return c+" "+b+", "+a+" - "+g}function findPos(a){var b=0,c=0;if(a.offsetParent){do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{x:b,y:c}}}function rgbToHex(a,b,c){if(255<a||255<b||255<c)throw"Invalid color component";return(a<<16|b<<8|c).toString(16)};